(this.webpackJsonpskillsmap=this.webpackJsonpskillsmap||[]).push([[0],{37:function(e,t,a){},38:function(e,t,a){},39:function(e,t,a){},40:function(e,t,a){},41:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){},45:function(e,t,a){"use strict";a.r(t);var r,n,i=a(0),o=a.n(i),c=a(21),s=a.n(c),l=a(9),d=a(15),u=a(8),p=a(1),v="ADD_SKILL_MAP",m="CLEAR_SKILL_MAPS",h="CLEAR_METADATA",f="CHANGE_SELECTED_ITEM",y="SET_SKILL_MAP_COMPLETED",b="SET_HEADERID_FOR_ACTIVITY",g="OPEN_ACTIVITY",I="CLOSE_ACTIVITY",k="SAVE_AND_CLOSE_ACTIVITY",E="RESTART_ACTIVITY",O="SET_RELOAD_HEADER_STATE",S="SET_USER",w="UPDATE_USER_COMPLETED_TAGS",C="RESET_USER",x="SET_PAGE_TITLE",j="SET_PAGE_DESCRIPTION",A="SET_PAGE_INFO_URL",N="SET_PAGE_BACKGROUND_IMAGE_URL",M="SET_PAGE_BANNER_IMAGE_URL",T="SET_PAGE_THEME",U="SET_PAGE_SOURCE_URL",P="SET_PAGE_ALTERNATE_URLS",R="SHOW_COMPLETION_MODAL",_="SHOW_RESTART_ACTIVITY_MODAL",L="SHOW_REPORT_ABUSE_MODAL",B="SHOW_RESET_USER_MODAL",H="SHOW_CARRYOVER_MODAL",D="SHOW_SHARE_MODAL",F="HIDE_MODAL",V=a(2),G=a.n(V),W=a(3),q="https://www.makecode.com/api";function J(e){var t={cmd:"",arg:""},a=/^(\w+)(:([:./\-+=\w]+))?/.exec((e||window.location.hash).replace(/^#/,""));return a&&(t={cmd:a[1],arg:a[3]||""}),t}function Y(){var e={},t=window.location.search;t&&new URLSearchParams(t).forEach((function(t,a){"true"!==t.toLowerCase()&&"1"!==t||(t="true"),e[a]=t}));return e}function z(e,t){return K.apply(this,arguments)}function K(){return(K=Object(W.a)(G.a.mark((function e(t,a){var r,n,i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&a){e.next=2;break}return e.abrupt("return",void 0);case 2:n="unknown",e.t0=t,e.next="docs"===e.t0?6:"github"===e.t0?9:"local"===e.t0?12:15;break;case 6:return r=ee(a),n="approved",e.abrupt("break",17);case 9:return e.next=11,X(a);case 11:return e.abrupt("return",e.sent);case 12:return e.next=14,Q(a);case 14:return e.abrupt("return",e.sent);case 15:return r=a,e.abrupt("break",17);case 17:return e.next=19,ie(r);case 19:return i=e.sent,e.abrupt("return",{text:i,identifier:r,status:n});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e){return $.apply(this,arguments)}function $(){return($=Object(W.a)(G.a.mark((function e(t){var a,r,n,i,o,c,s,l,d,u,p;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=pxt.github.parseRepoId(t),e.next=3,pxt.packagesConfigAsync();case 3:r=e.sent,n=pxt.github.parseRepoId(a.slug),i=pxt.github.repoStatus(n,r),o="unknown",e.t0=i,e.next=e.t0===pxt.github.GitRepoStatus.Banned?10:e.t0===pxt.github.GitRepoStatus.Approved?13:16;break;case 10:return o="banned",c="https://github.com/"+a.fullName,e.abrupt("break",18);case 13:return o="approved",c=void 0,e.abrupt("break",18);case 16:return c="https://github.com/"+a.fullName,e.abrupt("break",18);case 18:if(e.t1=a.tag,e.t1){e.next=23;break}return e.next=22,pxt.github.latestVersionAsync(a.slug,r,!0);case 22:e.t1=e.sent;case 23:if(s=e.t1){e.next=27;break}return pxt.log("skillmap github tag not found at ".concat(a.fullName)),e.abrupt("return",void 0);case 27:return a.tag=s,e.next=30,pxt.github.downloadPackageAsync("".concat(a.slug,"#").concat(a.tag),r);case 30:if(!(l=e.sent)){e.next=34;break}return d=te(a),u=d.identifier,p=d.fileName,e.abrupt("return",{text:pxt.tutorial.resolveLocalizedMarkdown(a,l.files,p),identifier:u,reportId:c,status:o});case 34:return e.abrupt("return",void 0);case 35:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){return Z.apply(this,arguments)}function Z(){return(Z=Object(W.a)(G.a.mark((function e(t){var a,r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!le()){e.next=9;break}return t=t.replace(/^\//,"").replace(/\.md$/,""),e.next=4,fetch("docs/"+t+".md");case 4:return a=e.sent,e.next=7,a.text();case 7:return r=e.sent,e.abrupt("return",{text:r,identifier:t,status:"approved"});case 9:return e.abrupt("return",void 0);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e){var t;e=e.trim().replace(/^[\\/]/i,"").replace(/\.md$/i,"");var a=(null===(t=window.pxtTargetBundle)||void 0===t?void 0:t.name)||"arcade";return"".concat(q,"/md/").concat(a,"/").concat(e)}function te(e){var t=function(e){return e=(e=(e=e.replace(/^\/?blob\/main\//,"")).replace(/^\/?blob\/master\//,"")).replace(/\.md$/,"")}(e.fileName||"skillmap");return{identifier:e.fullName+"#"+t,fileName:t}}function ae(e,t){return re.apply(this,arguments)}function re(){return(re=Object(W.a)(G.a.mark((function e(t,a){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&a){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.next=4,oe("".concat(q,"/scripts"),Object(p.a)(Object(p.a)({},t),{},{text:a}));case 4:return r=e.sent,e.abrupt("return",pxt.Util.jsonTryParse(r));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(){return(ne=Object(W.a)(G.a.mark((function e(t,a){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,oe("/api/".concat(encodeURIComponent(t),"/abusereports"),a);case 3:return e.abrupt("return");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ie(e){return new Promise((function(t,a){var r=new XMLHttpRequest;r.addEventListener("error",(function(e){a(e)})),r.addEventListener("load",(function(){try{t(r.responseText)}catch(e){a(e)}})),r.open("GET",e),r.send()}))}function oe(e,t){return new Promise((function(a,r){var n=new XMLHttpRequest;n.addEventListener("error",(function(e){r(e)})),n.addEventListener("load",(function(){try{a(n.responseText)}catch(e){r(e)}})),n.open("POST",e,!0),n.setRequestHeader("Content-type","application/json"),n.send(JSON.stringify(t))}))}function ce(){var e=new Uint8Array(4);return function(e){if(window.crypto)window.crypto.getRandomValues(e);else for(var t=0;t<e.length;++t)e[t]=Math.floor(255*Math.random())}(e),new Uint32Array(e.buffer)[0]}function se(){function e(){return(65536|ce()).toString(16).slice(-4)}return e()+e()+"-"+e()+"-4"+e().slice(-3)+"-"+e()+"-"+e()+e()+e()}function le(){return"localhost"===window.location.hostname}function de(e){return"".concat(le()?"":"/static/skillmap","/").concat(e.replace(/^\//,""))}function ue(e){n=e}function pe(e,t){var a,i;(t=t||{}).page=n,t.pageTitle=r,null===(a=(i=window).pxtTickEvent)||void 0===a||a.call(i,e,t)}var ve=a(10);function me(e,t,a,r){return!Object.keys(null===a||void 0===a?void 0:a.activities).some((function(n){var i,o;return!(null===(i=ge(e,t,a.mapId))||void 0===i||null===(o=i.activityState[n])||void 0===o?void 0:o.isCompleted)&&n!==r}))}function he(e,t,a,r){var n;return!!(null===(n=Ie(e,t,a,r))||void 0===n?void 0:n.isCompleted)}function fe(e,t,a,r){var n,i,o,c=e&&a&&be(e,t,a,r)?"notstarted":"locked";if(e)if(a&&t&&!function(e,t,a){var r,n=Object(ve.a)(t.prerequisites);try{for(n.s();!(r=n.n()).done;){var i=r.value;if("tag"===i.type){if(!e.completedTags[a])return!1;var o=e.completedTags[a][i.tag];if(void 0===o||o<i.numberCompleted)return!1}else if("map"===i.type&&!me(e,a,t))return!1}}catch(c){n.e(c)}finally{n.f()}return!0}(e,a,t))c="locked";else{var s=Ie(e,t,a.mapId,r);s&&(s.isCompleted?(c=s.currentStep&&s.maxSteps&&s.currentStep<s.maxSteps?"restarted":"completed",o=s.headerId):s.headerId&&(c="inprogress"),n=null===s||void 0===s?void 0:s.currentStep,i=null===s||void 0===s?void 0:s.maxSteps)}return{status:c,currentStep:n,maxSteps:i,completedHeadedId:o}}function ye(e,t,a){var r,n={},i=Object(ve.a)(a);try{for(i.s();!(r=i.n()).done;)for(var o=r.value,c=0,s=Object.keys(o.activities);c<s.length;c++){var l=s[c],d=o.activities[l];if(he(e,t,o.mapId,d.activityId)&&"activity"===d.kind){var u,p=Object(ve.a)(d.tags);try{for(p.s();!(u=p.n()).done;){var v=u.value;n[v]||(n[v]=0),n[v]++}}catch(m){p.e(m)}finally{p.f()}}}}catch(m){i.e(m)}finally{i.f()}return n}function be(e,t,a,r){return a.root.activityId===r||function n(i){if(he(e,t,a.mapId,i.activityId)){if(i.next.some((function(e){return e.activityId===r})))return!0;var o,c=Object(ve.a)(i.next);try{for(c.s();!(o=c.n()).done;){var s=o.value;if(n(s))return!0}}catch(l){c.e(l)}finally{c.f()}}return!1}(a.root)}function ge(e,t,a){return e.mapProgress[t]?e.mapProgress[t][a]:void 0}function Ie(e,t,a,r){var n;return null===(n=ge(e,t,a))||void 0===n?void 0:n.activityState[r]}function ke(e,t){return Object.keys(e.activities).filter((function(t){return!we(e.activities[t])})).filter((function(a){return Se(e.activities[a]).map((function(e){return e.activityId})).some((function(e){return e===t}))})).map((function(t){return e.activities[t]}))}function Ee(e,t,a,r){return ke(a,r).map((function(r){return Ie(e,t,a.mapId,r.activityId)})).filter((function(e){return!!e}))}function Oe(e,t,a,r){var n=Ee(e,t,a,r).filter((function(e){return(null===e||void 0===e?void 0:e.isCompleted)&&e.maxSteps===e.currentStep})).sort((function(e,t){return(t.completedTime||0)-(e.completedTime||0)}));return null===n||void 0===n?void 0:n[0]}function Se(e){if(we(e)){var t=[];return e.next.forEach((function(e){return t=t.concat(Se(e))})),t}return e.next}function we(e){return"reward"===e.kind||"completion"===e.kind}function Ce(e,t,a,r){var n=pxt.semver.parse(e.version||"0.0.0"),i=pxt.semver.parse(t),o=e;if(0===pxt.semver.cmp(n,i))return o;if(0===pxt.semver.cmp(n,pxt.semver.parse("0.0.0"))){var c=(null===e||void 0===e?void 0:e.mapProgress)&&Object.keys(null===e||void 0===e?void 0:e.mapProgress);if((null===c||void 0===c?void 0:c.length)>0&&e.mapProgress[c[0]].activityState){var s=e,l={};Object.keys(r).forEach((function(e){s.mapProgress[e]&&(l[e]=s.mapProgress[e])})),o=Object(p.a)(Object(p.a)({},s),{},{mapProgress:Object(u.a)({},a,l)})}}return o}function xe(e,t,a){if(0===a.length)return e;var r=e.mapProgress[t]||{};return a.forEach((function(t){var a=J(t),n=a.cmd,i=a.arg,o=i;switch(n){case"github":var c=pxt.github.parseRepoId(i),s=c&&te(c);o=(null===s||void 0===s?void 0:s.identifier)||i;break;case"docs":o=ee(i)}var l=e.mapProgress[o];l&&Object.keys(l).forEach((function(e){if(r[e]){var t=l[e].activityState;Object.keys(t).forEach((function(a){r[e].activityState[a]||(r[e].activityState[a]=t[a])}))}else r[e]=l[e]}))})),Object(p.a)(Object(p.a)({},e),{},{mapProgress:Object(p.a)(Object(p.a)({},e.mapProgress),{},Object(u.a)({},t,r))})}var je={title:lf("Game Maker Guide"),description:lf("Level up your game making skills by completing the tutorials in this guide."),pageSourceStatus:"unknown",pageSourceUrl:"default",user:{version:pxt.skillmap.USER_VERSION,isDebug:!0,id:se(),mapProgress:{},completedTags:{}},theme:{backgroundColor:"var(--body-background-color)",pathColor:"#BFBFBF",strokeColor:"#000000",rewardNodeColor:"var(--primary-color)",rewardNodeForeground:"#000000",unlockedNodeColor:"var(--secondary-color)",unlockedNodeForeground:"#000000",lockedNodeColor:"#BFBFBF",lockedNodeForeground:"#000000",completedNodeColor:"var(--secondary-color)",completedNodeForeground:"#000000",selectedStrokeColor:"var(--hover-color)",pathOpacity:.5},maps:{}};function Ae(e,t,a,r,n,i,o){var c,s,l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],d=a.mapId,v=Ie(e,t,d,r);v||(v={isCompleted:!1,activityId:r,currentStep:i,maxSteps:o,headerId:n});var m=(null===(c=e.mapProgress)||void 0===c?void 0:c[t])||{};return Object(p.a)(Object(p.a)({},e),{},{mapProgress:Object(p.a)(Object(p.a)({},e.mapProgress),{},Object(u.a)({},t,Object(p.a)(Object(p.a)({},m),{},Object(u.a)({},d,Object(p.a)(Object(p.a)({},(null===m||void 0===m?void 0:m[d])||{mapId:d}),{},{activityState:Object(p.a)(Object(p.a)({},(null===m||void 0===m||null===(s=m[d])||void 0===s?void 0:s.activityState)||{}),{},Object(u.a)({},r,Object(p.a)(Object(p.a)({},v),{},{headerId:n,currentStep:i,maxSteps:o,isCompleted:v.isCompleted||l})))})))))})}function Ne(e,t,a){var r=e.maps[t].activities[a];return!("activity"!==(null===r||void 0===r?void 0:r.kind)||!r.allowCodeCarryover)}function Me(e,t,a,r){var n,i,o,c=a.mapId,s=!1,l={};r.forEach((function(r){var n=Ie(e,t,c,r);s=s||we(a.activities[r])&&!(null===n||void 0===n?void 0:n.isCompleted),l[r]=n||{isCompleted:!0,activityId:r,headerId:"",currentStep:0},l[r].isCompleted=!0,l[r].completedTime=Date.now()}));var d=(null===(n=e.mapProgress)||void 0===n?void 0:n[t])||{};return Object(p.a)(Object(p.a)({},e),{},{mapProgress:Object(p.a)(Object(p.a)({},e.mapProgress),{},Object(u.a)({},t,Object(p.a)(Object(p.a)({},d),{},Object(u.a)({},c,Object(p.a)(Object(p.a)({},(null===d||void 0===d?void 0:d[c])||{mapId:c}),{},{activityState:Object(p.a)(Object(p.a)({},(null===d||void 0===d||null===(i=d[c])||void 0===i?void 0:i.activityState)||{}),l),completionState:s?"transitioning":null===d||void 0===d||null===(o=d[c])||void 0===o?void 0:o.completionState})))))})}function Te(e,t){var a=[e.activities[t]],r=e.activities[t].next.filter((function(e){return we(e)}));return a.concat(r)}var Ue=function(){var e,t,a,r,n,i,o,c,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:je,l=arguments.length>1?arguments[1]:void 0;switch(l.type){case v:return Object(p.a)(Object(p.a)({},s),{},{maps:Object(p.a)(Object(p.a)({},s.maps),{},Object(u.a)({},l.map.mapId,l.map))});case m:return Object(p.a)(Object(p.a)({},s),{},{maps:{}});case h:return Object(p.a)(Object(p.a)({},s),{},{title:je.title,description:je.description,infoUrl:je.infoUrl,backgroundImageUrl:void 0,bannerImageUrl:void 0,alternateSourceUrls:void 0,theme:Object(p.a)({},je.theme)});case f:return Object(p.a)(Object(p.a)({},s),{},{selectedItem:{mapId:l.mapId,activityId:l.activityId}});case y:return Object(p.a)(Object(p.a)({},s),{},{user:Object(p.a)(Object(p.a)({},s.user),{},{mapProgress:Object(p.a)(Object(p.a)({},s.user.mapProgress),{},Object(u.a)({},s.pageSourceUrl,Object(p.a)(Object(p.a)({},null===(e=s.user.mapProgress)||void 0===e?void 0:e[s.pageSourceUrl]),{},Object(u.a)({},l.mapId,Object(p.a)(Object(p.a)({},null===(t=s.user.mapProgress)||void 0===t||null===(a=t[s.pageSourceUrl])||void 0===a?void 0:a[l.mapId]),{},{completionState:"completed"})))))})});case g:return Object(p.a)(Object(p.a)({},s),{},{editorView:{currentMapId:l.mapId,currentActivityId:l.activityId,state:"active",allowCodeCarryover:Ne(s,l.mapId,l.activityId),currentHeaderId:null===(r=Ie(s.user,s.pageSourceUrl,l.mapId,l.activityId))||void 0===r?void 0:r.headerId}});case k:return Object(p.a)(Object(p.a)({},s),{},{editorView:Object(p.a)(Object(p.a)({},s.editorView),{},{state:"saving"})});case I:var d=s.maps[s.editorView.currentMapId],V=s.editorView.currentActivityId,G=l.finished?Te(d,V):[],W=G.find((function(e){return we(e)})),q=W&&(null===(n=s.user.mapProgress[s.pageSourceUrl])||void 0===n||null===(i=n[d.mapId])||void 0===i?void 0:i.activityState[W.activityId]);return Object(p.a)(Object(p.a)({},s),{},{selectedItem:W&&!q?{mapId:d.mapId,activityId:W.activityId}:s.selectedItem,editorView:void 0,user:l.finished?Me(s.user,s.pageSourceUrl,d,G.map((function(e){return e.activityId}))):s.user});case E:return Object(p.a)(Object(p.a)({},s),{},{modal:void 0,editorView:{state:"active",currentMapId:l.mapId,currentActivityId:l.activityId,allowCodeCarryover:Ne(s,l.mapId,l.activityId)},user:Ae(s.user,s.pageSourceUrl,s.maps[l.mapId],l.activityId)});case b:var J=(null===(o=s.editorView)||void 0===o?void 0:o.currentActivityId)===l.activityId&&(null===(c=s.editorView)||void 0===c?void 0:c.currentMapId)===l.mapId;return Object(p.a)(Object(p.a)({},s),{},{editorView:J?Object(p.a)(Object(p.a)({},s.editorView),{},{currentHeaderId:l.id}):s.editorView,user:Ae(s.user,s.pageSourceUrl,s.maps[l.mapId],l.activityId,l.id,l.currentStep,l.maxSteps)});case O:return Object(p.a)(Object(p.a)({},s),{},{editorView:s.editorView?Object(p.a)(Object(p.a)({},s.editorView),{},{state:l.state}):void 0});case S:var Y=s.pageSourceUrl,z=Ce(l.user,pxt.skillmap.USER_VERSION,Y,s.maps);return s.alternateSourceUrls&&(z=xe(z,Y,s.alternateSourceUrls)),z.mapProgress[Y]||(z.mapProgress[Y]={}),Object.keys(s.maps).forEach((function(e){z.mapProgress[Y][e]||(z.mapProgress[Y][e]={completionState:"incomplete",mapId:e,activityState:{}})})),Object(p.a)(Object(p.a)({},s),{},{user:z});case C:return Object(p.a)(Object(p.a)({},s),{},{user:Object(p.a)(Object(p.a)({},s.user),{},{completedTags:{},mapProgress:{}})});case w:return s.pageSourceUrl?Object(p.a)(Object(p.a)({},s),{},{user:Object(p.a)(Object(p.a)({},s.user),{},{completedTags:Object(p.a)(Object(p.a)({},s.user.completedTags),{},Object(u.a)({},s.pageSourceUrl,ye(s.user,s.pageSourceUrl,Object.keys(s.maps).map((function(e){return s.maps[e]})))))})}):s;case x:return Object(p.a)(Object(p.a)({},s),{},{title:l.title});case j:return Object(p.a)(Object(p.a)({},s),{},{description:l.description});case A:return Object(p.a)(Object(p.a)({},s),{},{infoUrl:l.infoUrl});case N:return Object(p.a)(Object(p.a)({},s),{},{backgroundImageUrl:l.backgroundImageUrl});case M:return Object(p.a)(Object(p.a)({},s),{},{bannerImageUrl:l.bannerImageUrl});case T:return Object(p.a)(Object(p.a)({},s),{},{theme:l.theme});case U:return Object(p.a)(Object(p.a)({},s),{},{pageSourceUrl:l.url,pageSourceStatus:l.status});case P:return Object(p.a)(Object(p.a)({},s),{},{alternateSourceUrls:l.urls});case R:return Object(p.a)(Object(p.a)({},s),{},{modal:{type:"completion",currentMapId:l.mapId,currentActivityId:l.activityId}});case H:return Object(p.a)(Object(p.a)({},s),{},{modal:{type:"carryover",currentMapId:l.mapId,currentActivityId:l.activityId}});case _:return Object(p.a)(Object(p.a)({},s),{},{modal:{type:"restart-warning",currentMapId:l.mapId,currentActivityId:l.activityId}});case L:return Object(p.a)(Object(p.a)({},s),{},{modal:{type:"report-abuse",currentMapId:l.mapId,currentActivityId:l.activityId}});case B:return Object(p.a)(Object(p.a)({},s),{},{modal:{type:"reset"}});case D:return Object(p.a)(Object(p.a)({},s),{},{modal:{type:"share",currentMapId:l.mapId,currentActivityId:l.activityId}});case F:return Object(p.a)(Object(p.a)({},s),{},{modal:void 0});default:return s}},Pe=Object(d.b)(Ue),Re=a(4),_e=a(5),Le=a(7),Be=a(6),He=function(e,t){return{type:g,mapId:e,activityId:t}},De=function(){return{type:k}},Fe=function(e){return{type:O,state:e}},Ve=function(e,t){return{type:R,mapId:e,activityId:t}},Ge=(a(37),function(e){Object(Le.a)(a,e);var t=Object(Be.a)(a);function a(e){var r;return Object(Re.a)(this,a),(r=t.call(this,e)).handleOnClick=function(){r.setState({expanded:!r.state.expanded})},r.handleOnBlur=function(){r.setState({expanded:!1})},r.state={expanded:!1},r}return Object(_e.a)(a,[{key:"getItemOnClick",value:function(e){return function(){return e.onClick(e.id)}}},{key:"render",value:function(){var e=this,t=this.props,a=t.icon,r=t.items,n=t.className,o=this.state.expanded;return i.createElement("div",{className:"dropdown ".concat(n," ").concat(o?"expanded":""),tabIndex:0,role:"button",onClick:this.handleOnClick,onBlur:this.handleOnBlur},i.createElement("i",{className:"icon ".concat(a)}),o&&i.createElement("div",{className:"dropdown-menu"},r.map((function(t,a){return i.createElement("div",{key:a,className:"dropdown-item",onClick:e.getItemOnClick(t),role:"menuitem"},t.label)}))))}}]),a}(i.Component)),We=function(e){Object(Le.a)(a,e);var t=Object(Be.a)(a);function a(){var e;Object(Re.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).reportAbuseUrl="https://github.com/contact/report-content",e.onBackClicked=function(){var t=e.props;pe("skillmap.activity.back",{path:t.currentMapId||"",activity:t.currentActivityId||""}),e.props.dispatchSaveAndCloseActivity()},e.onHomeClicked=function(){pe("skillmap.home"),window.open(pxt.appTarget.appTheme.homeUrl)},e.onBugClicked=function(){var e,t;pe("skillmap.bugreport"),null===(e=(t=window).usabilla_live)||void 0===e||e.call(t,"click")},e}return Object(_e.a)(a,[{key:"getSettingItems",value:function(){var e=this,t=[];return this.props.showReportAbuse&&t.push({id:"report",label:lf("Report Abuse"),onClick:function(t){pe("skillmap.reportabuse"),window.open(e.reportAbuseUrl)}}),this.props.activityOpen||t.push({id:"reset",label:lf("Reset All"),onClick:function(){pe("skillmap.reset.warning"),e.props.dispatchShowResetUserModal()}}),t}},{key:"getHelpItems",value:function(){var e=[];return this.props.activityOpen&&e.push({id:"feedback",label:lf("Feedback"),onClick:this.onBugClicked}),e}},{key:"render",value:function(){var e,t,a,r,n=this.props,o=n.activityOpen,c=n.currentActivityDisplayName,s="Microsoft Logo",l=le()||!(null===(e=pxt.appTarget)||void 0===e||null===(t=e.appTheme)||void 0===t?void 0:t.logoUrl)?de("assets/logo.svg"):null===(a=pxt.appTarget)||void 0===a||null===(r=a.appTheme)||void 0===r?void 0:r.logo,d=this.getSettingItems(),u=this.getHelpItems();return i.createElement("div",{className:"header"},i.createElement("div",{className:"header-left"},i.createElement("div",{className:"header-logo"},i.createElement("img",{src:l,alt:"MakeCode Logo"})),o?i.createElement(qe,{icon:"icon arrow left",label:lf("Back"),title:lf("Return to activity selection"),onClick:this.onBackClicked}):i.createElement(qe,{icon:"icon home",label:lf("Home"),title:lf("Return to the editor homepage"),onClick:this.onHomeClicked})),c&&i.createElement("div",{className:"header-activity-display-name",title:c},c),i.createElement("div",{className:"spacer"}),i.createElement("div",{className:"header-right"},(null===u||void 0===u?void 0:u.length)>0&&i.createElement(Ge,{icon:"help circle",className:"header-dropdown",items:u}),(null===d||void 0===d?void 0:d.length)>0&&i.createElement(Ge,{icon:"setting",className:"header-dropdown",items:d}),i.createElement("div",{className:"header-org-logo"},i.createElement("img",{className:"header-org-logo-large",src:de("assets/microsoft.png"),alt:s}),i.createElement("img",{className:"header-org-logo-small",src:de("assets/microsoft-square.png"),alt:s}))))}}]),a}(i.Component),qe=function(e){var t=e.icon,a=e.label,r=e.title,n=e.onClick;return i.createElement("div",{className:"header-button ".concat(a?"":"icon-only"),title:r,role:"button",onClick:n},i.createElement("i",{className:t}),a&&i.createElement("span",{className:"header-button-label"},a))};var Je,Ye,ze={dispatchSaveAndCloseActivity:De,dispatchShowResetUserModal:function(){return{type:B}}},Ke=Object(l.b)((function(e,t){var a,r,n,i;if(!e)return{};(null===(a=e.editorView)||void 0===a?void 0:a.currentHeaderId)&&he(e.user,e.pageSourceUrl,e.editorView.currentMapId,e.editorView.currentActivityId)&&e.editorView.currentHeaderId;var o,c=!!e.editorView;if(null===(r=e.editorView)||void 0===r?void 0:r.currentActivityId){var s=e.maps[e.editorView.currentMapId].activities[e.editorView.currentActivityId];s&&(o=s.displayName)}return{activityOpen:c,currentMapId:c&&(null===(n=e.editorView)||void 0===n?void 0:n.currentMapId),currentActivityId:c&&(null===(i=e.editorView)||void 0===i?void 0:i.currentActivityId),showReportAbuse:"unknown"===e.pageSourceStatus,currentActivityDisplayName:o}}),ze)(We);function Xe(){return Ye||(Je=new pxt.skillmap.IndexedDBWorkspace,Ye=Je.initAsync().then((function(e){return Je}))),Ye}function $e(e){return Qe.apply(this,arguments)}function Qe(){return(Qe=Object(W.a)(G.a.mark((function e(t){var a;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xe();case 2:return a=e.sent,e.abrupt("return",a.getProjectAsync(t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ze(e){return et.apply(this,arguments)}function et(){return(et=Object(W.a)(G.a.mark((function e(t){var a;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xe();case 2:return a=e.sent,e.next=5,a.saveProjectAsync(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tt(){return at.apply(this,arguments)}function at(){return(at=Object(W.a)(G.a.mark((function e(){var t;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xe();case 2:return t=e.sent,e.abrupt("return",t.getUserStateAsync());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rt(e){return nt.apply(this,arguments)}function nt(){return(nt=Object(W.a)(G.a.mark((function e(t){var a;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isDebug){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Xe();case 4:return a=e.sent,e.next=7,a.saveUserStateAsync(t);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function it(e,t,a,r,n){return ot.apply(this,arguments)}function ot(){return(ot=Object(W.a)(G.a.mark((function e(t,a,r,n,i){var o,c,s,l,d,u,p;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=t.mapProgress[a][r.mapId],s=null===(o=c.activityState[n])||void 0===o?void 0:o.headerId,l=Oe(t,a,r,n),d=null===l||void 0===l?void 0:l.headerId,s&&d){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,$e(d);case 8:return u=e.sent,e.next=11,$e(s);case 11:return(p=e.sent).text=ct(u.text,p.text,i),e.next=15,Ze(p);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ct(e,t,a){var r,n,i,o=t[pxt.CONFIG_NAME],c=pxt.U.jsonTryParse(o),s=a?st(t[pxt.TILEMAP_JRES],e[pxt.TILEMAP_JRES]):st(e[pxt.TILEMAP_JRES],t[pxt.TILEMAP_JRES]),l=a?st(t[pxt.IMAGES_JRES],e[pxt.IMAGES_JRES]):st(function(e,t){if(!e)return t;var a=pxt.U.jsonTryParse(t)||{};a["*"]||(a["*"]={mimeType:"image/x-mkcd-f4",dataEncoding:"base64",namespace:pxt.sprite.IMAGES_NAMESPACE});var r=0;return function(e){var t=/<field name=\"[\da-zA-Z]+\">\s*(img`[\s\da-f.#tngrpoyw]+`)\s*<\/field>/gim,a=[];return e.replace(t,(function(e,t){var r,n=null===(r=pxt.sprite.imageLiteralToBitmap(t))||void 0===r?void 0:r.data();return n&&a.push(n),e})),a}(e).forEach((function(e){for(var t=se();a["".concat(pxt.sprite.IMAGES_NAMESPACE,".").concat(pxt.sprite.IMAGE_PREFIX).concat(r)];)r++;a[t]={data:pxt.sprite.base64EncodeBitmap(e),mimeType:pxt.IMAGE_MIME_TYPE,displayName:"".concat(pxt.sprite.IMAGES_NAMESPACE,".").concat(pxt.sprite.IMAGE_PREFIX).concat(r)},r++})),r=0,function(e){var t=/<field name=\"[\da-zA-Z]+\">\s*\[((?:img`[\s\da-f.#tngrpoyw]+`,?)+)\]\s*<\/field>(?:.*<shadow type=\"timePicker\"><field name=\"ms\">(\d+)<\/field><\/shadow>)?/gim,a=[];return e.replace(t,(function(e,t,r){var n=t.split(",").map((function(e){var t;return null===(t=pxt.sprite.imageLiteralToBitmap(e))||void 0===t?void 0:t.data()}));return a.push({frames:n.filter((function(e){return!!e})),interval:r||500}),e})),a}(e).forEach((function(e){for(var t=se();a["".concat(pxt.sprite.ANIMATION_NAMESPACE,".").concat(pxt.sprite.ANIMATION_NAMESPACE).concat(r)];)r++;a[t]={data:pxt.sprite.encodeAnimationString(e.frames,e.interval),mimeType:pxt.ANIMATION_MIME_TYPE,displayName:"".concat(pxt.sprite.ANIMATION_NAMESPACE,".").concat(pxt.sprite.ANIMATION_PREFIX).concat(r)},r++})),JSON.stringify(a)}(e["main.blocks"],e[pxt.IMAGES_JRES]),t[pxt.IMAGES_JRES]);return s&&(null===c||void 0===c||null===(r=c.files)||void 0===r?void 0:r.indexOf(pxt.TILEMAP_JRES))<0&&c.files.push(pxt.TILEMAP_JRES),l&&(null===c||void 0===c||null===(n=c.files)||void 0===n?void 0:n.indexOf(pxt.IMAGES_JRES))<0&&c.files.push(pxt.IMAGES_JRES),Object(p.a)(Object(p.a)({},t),{},(i={},Object(u.a)(i,"main.ts",a?e["main.ts"]:t["main.ts"]),Object(u.a)(i,"main.py",a?e["main.py"]:t["main.py"]),Object(u.a)(i,"main.blocks",a?e["main.blocks"]:t["main.blocks"]),Object(u.a)(i,pxt.TILEMAP_JRES,s),Object(u.a)(i,pxt.IMAGES_JRES,l),Object(u.a)(i,pxt.CONFIG_NAME,JSON.stringify(c)),i))}function st(e,t){if(!e)return t;if(!t)return e;for(var a=JSON.parse(e),r=JSON.parse(t),n={},i={},o={},c={},s={},l=r["*"].mimeType,d=0,u=Object.keys(r);d<u.length;d++){var v=u[d];if("*"!==v){var m=r[v];o[v]=!0;var h=void 0,f=l,y=!1;if("string"===typeof m?h=m:(h=m.data,f=m.mimeType,y=!!m.tilemapTile,m.displayName&&(i[m.displayName]=!0)),f!==pxt.TILEMAP_MIME_TYPE)n[f+y+h]=v}}for(var b=0,g=Object.keys(a);b<g.length;b++){var I=g[b];if("*"!==I){var k=a[I],E=void 0,O=void 0,S=l,w=!1,C=!1;"string"===typeof k?(E=k,C=!0):(E=k.data,O=k.displayName,S=k.mimeType,w=!!k.tilemapTile);var x=S+w+E;if(n[x])w&&(c[pxt.sprite.TILE_NAMESPACE+"."+I]=pxt.sprite.TILE_NAMESPACE+"."+n[x]);else{if(!O)switch(S){case pxt.IMAGE_MIME_TYPE:O=w?"".concat(pxt.sprite.TILE_NAMESPACE,".").concat(pxt.sprite.TILE_PREFIX):"".concat(pxt.sprite.IMAGES_NAMESPACE,".").concat(pxt.sprite.IMAGE_PREFIX);break;case pxt.TILEMAP_MIME_TYPE:O="tilemap";break;case pxt.ANIMATION_MIME_TYPE:O="".concat(pxt.sprite.ANIMATION_NAMESPACE,".").concat(pxt.sprite.ANIMATION_PREFIX)}if(O&&i[O]){for(var j=0;i[O+j];)j++;i[O+=j]=!0}var A=I;if(o[A]){for(var N=0;o[A+N];)N++;o[A+=N]=!0,w&&(c[pxt.sprite.TILE_NAMESPACE+"."+I]=pxt.sprite.TILE_NAMESPACE+"."+A)}S!==pxt.TILEMAP_MIME_TYPE&&(n[x]=I);var M=Object(p.a)(Object(p.a)({},C?{}:a[I]),{},{data:E,displayName:O,mimeType:S});M.id&&(M.id=A),S===pxt.TILEMAP_MIME_TYPE?s[A]=M:r[A]=M}}}for(var T=0,U=Object.keys(s);T<U.length;T++){var P,R=U[T],_=s[R];_.tileset=null===(P=_.tileset)||void 0===P?void 0:P.map((function(e){return c[e]||e})),r[R]=_}return JSON.stringify(r)}a(38);var lt=function(e){Object(Le.a)(a,e);var t=Object(Be.a)(a);function a(){var e;Object(Re.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).handleModalClick=function(e){e.stopPropagation(),e.preventDefault()},e.handleCloseClick=function(){e.props.onClose&&e.props.onClose(),e.setState({visible:!1})},e}return Object(_e.a)(a,[{key:"render",value:function(){var e=this.props,t=e.title,a=e.actions,r=e.className;return i.createElement("div",{className:"modal-overlay",onClick:this.handleCloseClick,role:"region"},i.createElement("div",{className:"modal ".concat(r||""),onClick:this.handleModalClick,role:"dialog"},i.createElement("div",{className:"modal-header"},i.createElement("div",{className:"modal-title"},t),i.createElement("div",{className:"spacer"}),i.createElement("div",{className:"modal-close-icon",onClick:this.handleCloseClick,role:"button"},i.createElement("i",{className:"icon close"}))),i.createElement("div",{className:"modal-body"},this.props.children),a&&a.length>0&&i.createElement("div",{className:"modal-actions"},a.map((function(e,t){return i.createElement("div",{key:t,className:"modal-button ".concat(e.className||""),onClick:e.onClick,role:"button"},e.label)})))))}}]),a}(i.Component),dt=function(e){Object(Le.a)(a,e);var t=Object(Be.a)(a);function a(e){var r;return Object(Re.a)(this,a),(r=t.call(this,e)).handleOnClose=function(){r.setState({loading:!1,data:void 0}),r.props.dispatchHideModal()},r.handleShareInputClick=function(e){e.target.select()},r.handleShareCopyClick=function(){var e=r.props;pe("skillmap.share.copy",{path:e.mapId,activity:e.activity.activityId});var t=document.querySelector(".share-input input");t&&(t.select(),document.execCommand("copy"))},r.state={},r}return Object(_e.a)(a,[{key:"render",value:function(){var e=this.props,t=e.activity;switch(e.type){case"completion":return t?this.renderCompletionModal():i.createElement("div",null);case"restart-warning":return t?this.renderRestartWarning():i.createElement("div",null);case"report-abuse":return this.renderReportAbuse();case"reset":return this.renderResetWarning();case"carryover":return this.renderCodeCarryoverModal();case"share":return this.renderShareModal();default:return i.createElement("div",null)}}},{key:"getRewardText",value:function(e){switch(e){case"certificate":return lf("Certificate");default:return lf("Reward")}}},{key:"renderCompletionModal",value:function(){var e=this.props,t=e.mapId,a=e.skillMap,r=e.type,n=e.activity;if(!r||!a)return i.createElement("div",null);var o=n,c=lf("You Did It!"),s=lf("Congratulations on completing {0}. Take some time to explore any activities you missed, or reset your progress to try again. But first, be sure to claim your reward using the button below.","{0}").split("{0}"),l=[{label:this.getRewardText(o.type),onClick:function(){pe("skillmap.reward",{path:t,activity:o.activityId}),window.open(o.url||a.completionUrl)}}];return i.createElement("div",{className:"confetti-container"},i.createElement(lt,{title:c,actions:l,className:"completion",onClose:this.handleOnClose},s[0],i.createElement("strong",null,a.displayName),s[1]),Array(100).fill(0).map((function(e,t){var a={animationDelay:"".concat(t%100*.1,"s"),left:"".concat(1*Math.floor(100*Math.random()),"%")};return i.createElement("div",{key:t,style:a,className:"confetti ".concat(Math.random()>.5?"reverse":""," color-").concat(Math.floor(9*Math.random()))})})))}},{key:"renderRestartWarning",value:function(){var e=this.props,t=e.mapId,a=e.activity,r=e.dispatchRestartActivity,n=lf("Restart Activity?"),o=lf("Are you sure you want to restart {0}? You won't lose your path progress but the code you have written for this activity will be deleted.","{0}").split("{0}"),c=[{label:lf("CANCEL"),onClick:this.handleOnClose},{label:lf("RESTART"),onClick:function(){pe("skillmap.activity.restart",{path:t,activity:a.activityId}),r(t,a.activityId)}}];return i.createElement(lt,{title:n,actions:c,onClose:this.handleOnClose},o[0],i.createElement("strong",null,a.displayName),o[1])}},{key:"renderResetWarning",value:function(){var e=this.props,t=e.dispatchResetUser,a=e.dispatchHideModal,r=lf("Reset All Activities?"),n=lf("Are you sure you want to reset? This will permanently erase all progress and delete the project created for each tutorial. This action cannot be undone."),o=[{label:lf("CANCEL"),onClick:this.handleOnClose},{label:lf("RESET"),onClick:function(){pe("skillmap.reset"),t(),a()}}];return i.createElement(lt,{title:r,actions:o,onClose:this.handleOnClose},n)}},{key:"renderReportAbuse",value:function(){var e=this.props,t=e.pageSourceUrl,a=e.dispatchHideModal,r=[{label:"REPORT",onClick:function(){pe("skillmap.reportabuse"),function(e,t){ne.apply(this,arguments)}(t||"",{text:document.querySelector(".report-abuse-text").value}),a()}}];return i.createElement(lt,{title:"Report Abuse",actions:r,onClose:this.handleOnClose},i.createElement("textarea",{className:"report-abuse-text",placeholder:"Describe the content and explain why you are reporting it for abuse. Provide as much detail as possible!"}))}},{key:"renderCodeCarryoverModal",value:function(){var e=this.props,t=e.skillMap,a=e.activity,r=e.pageSourceUrl,n=e.userState,o=e.dispatchHideModal,c=e.dispatchSetReloadHeaderState,s=lf("Keep code from previous activity?"),l=lf("Do you want to start with your code from {0} or start fresh with starter code? Your images, tilemaps, tiles, and animations will stick around either way.").split("{0}"),d=Oe(n,r,t,a.activityId),u=t.activities[null===d||void 0===d?void 0:d.activityId];if(!u)return i.createElement("div",null);var p=[{label:lf("START FRESH"),onClick:function(){var e=Object(W.a)(G.a.mark((function e(){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return pe("skillmap.startfresh",{path:t.mapId,activity:a.activityId,previousActivity:u.activityId}),c("reloading"),e.next=4,it(n,r,t,a.activityId,!1);case 4:c("reload"),o();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{label:lf("KEEP CODE"),onClick:function(){var e=Object(W.a)(G.a.mark((function e(){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return pe("skillmap.keepcode",{path:t.mapId,activity:a.activityId,previousActivity:u.activityId}),c("reloading"),e.next=4,it(n,r,t,a.activityId,!0);case 4:c("reload"),o();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}];return i.createElement(lt,{title:s,actions:p,onClose:this.handleOnClose},l[0],i.createElement("strong",null,u.displayName),l[1])}},{key:"renderShareModal",value:function(){var e=this,t=this.props,a=t.userState,r=t.pageSourceUrl,n=t.mapId,o=t.activity,c=this.state,s=c.loading,l=c.data,d=(null===l||void 0===l?void 0:l.shortId)?lf("Share Project"):lf("Publish Project"),u=[];return(null===l||void 0===l?void 0:l.shortId)||(u.push({label:lf("Cancel"),onClick:function(){return e.handleOnClose}}),u.push({label:lf("Publish"),onClick:function(){var t=Object(W.a)(G.a.mark((function t(){var i,c,s;return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pe("skillmap.share",{path:n,activity:o.activityId}),e.setState({loading:!0}),i=Ie(a,r,n,o.activityId),t.next=5,$e((null===i||void 0===i?void 0:i.headerId)||"");case 5:return c=t.sent,t.next=8,ae(null===c||void 0===c?void 0:c.header,null===c||void 0===c?void 0:c.text);case 8:(null===(s=t.sent)||void 0===s?void 0:s.shortid)&&e.setState({loading:!1,data:{shortId:null===s||void 0===s?void 0:s.shortid}});case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()})),i.createElement(lt,{title:d,actions:u,onClose:this.handleOnClose},(null===l||void 0===l?void 0:l.shortId)?i.createElement("div",null,lf("Your project is ready! Use the address below to share your projects.")):i.createElement("div",{className:"share-disclaimer"},lf("You need to publish your project to share it or embed it in other web pages. You acknowledge having consent to publish this project.")),s&&i.createElement("div",{className:"share-loader"},i.createElement("div",{className:"ui active inline loader"}),i.createElement("span",null,lf("Loading..."))),(null===l||void 0===l?void 0:l.shortId)&&i.createElement("div",{className:"share-input"},i.createElement("input",{type:"text",readOnly:!0,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,value:"https://makecode.com/".concat(null===l||void 0===l?void 0:l.shortId),onClick:this.handleShareInputClick}),i.createElement("div",{className:"share-copy",onClick:this.handleShareCopyClick,role:"button"},i.createElement("i",{className:"icon copy"}),lf("Copy"))))}}]),a}(i.Component);var ut={dispatchHideModal:function(){return{type:F}},dispatchRestartActivity:function(e,t){return{type:E,mapId:e,activityId:t}},dispatchOpenActivity:He,dispatchResetUser:function(){return{type:C}},dispatchSetReloadHeaderState:Fe},pt=Object(l.b)((function(e,t){if(!e)return{};var a=e.pageSourceUrl,r=e.modal||{},n=r.currentMapId,i=r.currentActivityId;return{type:r.type,pageSourceUrl:a,skillMap:e.editorView?e.maps[e.editorView.currentMapId]:n&&e.maps[n],userState:e.user,mapId:n,activity:n&&i?e.maps[n].activities[i]:void 0}}),ut)(dt),vt=(a(39),function(e){Object(Le.a)(a,e);var t=Object(Be.a)(a);function a(e){var r;return Object(Re.a)(this,a),(r=t.call(this,e)).handleClick=function(){r.props.onItemSelect&&r.props.onItemSelect(r.props.activityId,r.props.kind)},r.handleDoubleClick=function(){r.props.onItemDoubleClick&&r.props.onItemDoubleClick(r.props.activityId,r.props.kind)},r.handleRef=function(e){e&&(e.addEventListener("mouseenter",(function(){r.setState({hover:!0})})),e.addEventListener("mouseleave",(function(){r.setState({hover:!1})})))},r.state={hover:!1},r}return Object(_e.a)(a,[{key:"getIcon",value:function(e,t){switch(t){case"reward":return"\uf059";case"completion":return"\uf091";default:switch(e){case"locked":return"\uf023";case"completed":return"\uf058";default:return"\uf101"}}}},{key:"getIconClass",value:function(e,t){switch(t){case"reward":case"completion":return"graph-icon";default:switch(e){case"locked":case"completed":return"graph-icon";default:return"graph-icon-x"}}}},{key:"getNodeMarker",value:function(e,t,a,r){var n,o,c=t/50,s=t/576;switch(e){case"notstarted":return i.createElement("g",{transform:"translate(".concat(t/2-12*c," ").concat(-t/2-9*c,")")},i.createElement("title",null,lf("Not Started")),i.createElement("g",{transform:"scale(".concat(s/2,")")},(n=a,o=r,i.createElement("path",{fill:n,stroke:o,strokeWidth:"50",d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}))));default:return i.createElement("g",null)}}},{key:"render",value:function(){var e=this.state.hover,t=this.props,a=t.width,r=t.position,n=t.selected,o=t.status,c=t.kind,s=t.theme,l=e?s.unlockedNodeColor:s.unlockedNodeForeground,d=e?s.unlockedNodeForeground:s.unlockedNodeColor;"locked"===o?(d=e?s.lockedNodeForeground:s.lockedNodeColor,l=e?s.lockedNodeColor:s.lockedNodeForeground):"activity"!==c?(d=e?s.rewardNodeForeground:s.rewardNodeColor,l=e?s.rewardNodeColor:s.rewardNodeForeground):"completed"===o&&(d=e?s.completedNodeForeground:s.completedNodeColor,l=e?s.completedNodeColor:s.completedNodeForeground);var u=a/8;return i.createElement("g",{className:"graph-activity ".concat(n?"selected":""," ").concat(e?"hover":""),transform:"translate(".concat(r.x," ").concat(r.y,")"),onClick:this.handleClick,onDoubleClick:this.handleDoubleClick,ref:this.handleRef},n&&("activity"!==c?i.createElement("circle",{className:"highlight",cx:0,cy:0,r:a/2+u,stroke:s.selectedStrokeColor}):i.createElement("rect",{className:"highlight",x:-a/2-u,y:-a/2-u,width:a+2*u,height:a+2*u,rx:a/6,stroke:s.selectedStrokeColor})),"activity"!==c?i.createElement("circle",{cx:0,cy:0,r:a/2,fill:d,stroke:l,strokeWidth:"2"}):i.createElement("rect",{x:-a/2,y:-a/2,width:a,height:a,rx:a/10,fill:d,stroke:l,strokeWidth:"2"}),"activity"===c&&this.getNodeMarker(o,a,s.selectedStrokeColor,s.strokeColor),i.createElement("text",{dy:"4",textAnchor:"middle",alignmentBaseline:"middle",fill:l,className:this.getIconClass(o,c)},this.getIcon(o,c)))}}]),a}(i.Component));var mt=function(e){Object(Le.a)(a,e);var t=Object(Be.a)(a);function a(){return Object(Re.a)(this,a),t.apply(this,arguments)}return Object(_e.a)(a,[{key:"render",value:function(){var e,t,a=this.props,r=a.points,n=a.strokeWidth,o=a.color,c="M 0 0",s="";return r.forEach((function(a){var r,n,i,o;(e=a,t)&&(c+=" l ".concat(((null===(r=t)||void 0===r?void 0:r.x)||0)-e.x," ").concat(((null===(n=t)||void 0===n?void 0:n.y)||0)-e.y),s=" l ".concat(e.x-((null===(i=t)||void 0===i?void 0:i.x)||0)," ").concat(e.y-((null===(o=t)||void 0===o?void 0:o.y)||0)," ").concat(s));t=e})),i.createElement("g",{transform:"translate(".concat(t.x||0," ").concat(t.y||0,")")},i.createElement("path",{stroke:o,strokeWidth:n,d:"".concat(c," ").concat(s)}))}}]),a}(i.Component),ht=function(e){Object(Le.a)(a,e);var t=Object(Be.a)(a);function a(e){var r;return Object(Re.a)(this,a),(r=t.call(this,e)).onItemSelect=function(e,t){var a=r.props,n=a.user,i=a.pageSourceUrl,o=a.map,c=(a.completionState,a.selectedActivityId),s=a.dispatchChangeSelectedItem,l=a.dispatchShowCompletionModal,d=fe(n,i,o,e).status;"completion"===t&&"completed"===d?(pe("skillmap.graph.reward.select",{path:o.mapId,activity:e}),s(o.mapId,e),l(o.mapId,e)):e!==c?(pe("skillmap.graph.item.select",{path:o.mapId,activity:e}),s(o.mapId,e)):(pe("skillmap.graph.item.deselect",{path:o.mapId,activity:e}),s(void 0))},r.onItemDoubleClick=function(e,t){var a=r.props,n=a.user,i=a.pageSourceUrl,o=a.map,c=a.dispatchOpenActivity;"activity"===t&&be(n,i,o,e)&&c(o.mapId,e)},r}return Object(_e.a)(a,[{key:"componentDidUpdate",value:function(e){"transitioning"===e.completionState&&setTimeout((function(){pe("skillmap.graph.reward.auto",{path:e.map.mapId,activity:e.selectedActivityId||""}),e.dispatchSetSkillMapCompleted(e.map.mapId),e.dispatchShowCompletionModal(e.map.mapId,e.selectedActivityId)}),400)}},{key:"render",value:function(){var e=this,t=this.props,a=t.unit,r=t.items,n=t.paths,o=t.map,c=t.user,s=t.selectedActivityId,l=t.pageSourceUrl,d=t.theme;return i.createElement("g",{className:"skill-graph"},i.createElement("g",{opacity:d.pathOpacity},n.map((function(e,t){return i.createElement(mt,{key:"graph-activity-".concat(t),strokeWidth:3*a,color:d.strokeColor,points:e.points})})),n.map((function(e,t){return i.createElement(mt,{key:"graph-activity-".concat(t),strokeWidth:3*a-4,color:d.pathColor,points:e.points})}))),r.map((function(t,r){return i.createElement(vt,{key:"graph-activity-".concat(r),theme:d,kind:t.activity.kind,activityId:t.activity.activityId,position:t.position,width:5*a,selected:t.activity.activityId===s,onItemSelect:e.onItemSelect,onItemDoubleClick:e.onItemDoubleClick,status:fe(c,l,o,t.activity.activityId).status})})))}}]),a}(i.Component);var ft={dispatchChangeSelectedItem:function(e,t){return{type:f,mapId:e,activityId:t}},dispatchShowCompletionModal:Ve,dispatchSetSkillMapCompleted:function(e){return{type:y,mapId:e}},dispatchOpenActivity:He},yt=Object(l.b)((function(e,t){var a,r,n,i;if(!e)return{};var o=null===(a=e.user)||void 0===a||null===(r=a.mapProgress)||void 0===r?void 0:r[e.pageSourceUrl];return{user:e.user,pageSourceUrl:e.pageSourceUrl,theme:e.theme,selectedActivityId:e.selectedItem&&(null===(n=t.map)||void 0===n?void 0:n.mapId)==e.selectedItem.mapId?e.selectedItem.activityId:void 0,completionState:null===o||void 0===o||null===(i=o[t.map.mapId])||void 0===i?void 0:i.completionState}}),ft)(ht),bt=(a(18),10);function gt(e){var t,a=function(e){var t=St(e),a=[t],r={},n={},i=0,o=function(){var e=a.shift();if(e&&!n[e.activityId]){var t;n[e.activityId]=!0;var o=null===(t=e.parents)||void 0===t?void 0:t[0];if(o){var c=r[o.activityId]||{depth:0,offset:0};0==c.depth?(c.depth=1,e.offset=o.offset+c.offset):(i+=1,c.offset=i,e.offset=i),e.depth=o.depth+c.depth,r[o.activityId]=c}else e.depth=0,e.offset=0;var s=e.next.map((function(t){var a=t;return a.parents?a.parents.push(e):a.parents=[e],a}));s.filter((function(e){return n[e.activityId]})).forEach((function(t){(function(e,t){return!(!e.parents||!t.parents)&&(e.parents.forEach((function(e){t.parents.indexOf(e)>=0&&(a=e)})),!!a&&1==Math.abs(a.nextIds.indexOf(e.activityId)-a.nextIds.indexOf(t.activityId))&&e.depth==t.depth);var a})(t,e)||(t.offset+=1,i=Math.max(i,t.offset),t.depth=Math.max(t.depth,e.depth+1))})),a=s.concat(a)}};for(;a.length>0;)o();var c=function(e){var t=[],a=[e],r={};for(;a.length>0;){var n=a.shift();n&&!r[n.activityId]&&(r[n.activityId]=!0,t.push(n),a=n.next.concat(a))}return t}(t).filter((function(e){return"layout"!==e.kind})),s={};return c.forEach((function(e){void 0==s[e.depth]&&(s[e.depth]=[]),s[e.depth].push(e.offset)})),c.forEach((function(e){var t;if((!e.next||0==e.next.length)&&1==(null===(t=e.parents)||void 0===t?void 0:t.length)){var a=e.parents[0],r=s[e.depth],n=r[r.indexOf(e.offset)-1];(n?e.offset-n:Math.abs(e.depth-a.depth)+Math.abs(e.offset-a.offset))>2&&(e.depth=a.depth,e.offset=(n||a.offset)+1)}})),c.forEach((function(e){if(e.parents){e.edges=[];var t=e.parents.some((function(t){return t.offset==e.offset}))||e.parents.length>2;e.parents.forEach((function(a){var r,n=[{depth:a.depth,offset:a.offset}];if(t){var i=s[e.depth],o=i.indexOf(e.offset),c=e.offset>a.offset&&!(i[o+1]-i[o]<e.offset-a.offset),l=e.offset<a.offset&&!(i[o]-i[o-1]<a.offset-e.offset);c||l?n.push({depth:a.depth,offset:e.offset}):n.push({depth:e.depth,offset:a.offset})}else n.push({depth:e.depth,offset:a.offset});n.push({depth:e.depth,offset:e.offset}),null===(r=e.edges)||void 0===r||r.push(n)}))}})),c}(e.root),r=0,n=0,i=[],o=[],c=Object(ve.a)(a);try{for(c.s();!(t=c.n()).done;){var s=t.value,l=s.depth,d=s.offset;i.push({activity:s,position:It(l,d)}),s.edges&&s.edges.forEach((function(e){var t=[];e.forEach((function(e){return t.push(It(e.depth,e.offset))})),o.push({points:t})})),r=Math.max(r,s.depth),n=Math.max(n,s.offset)}}catch(v){c.e(v)}finally{c.f()}var u=kt(r)+40,p=Et(n)+40;return{map:e,items:i,paths:o,width:u,height:p}}function It(e,t){return{x:kt(e),y:Et(t)}}function kt(e){return(12*e+4)*bt}function Et(e){return(9*e+4)*bt}function Ot(e){for(var t=[],a=[e],r={};a.length>0;){var n=a.shift();n&&!r[n.activityId]&&(r[n.activityId]=!0,t.push(n),a=a.concat(n.next))}return t}function St(e){var t=Ot(e),a={};return t.forEach((function(e){return a[e.activityId]=Object.assign({},e)})),Object.keys(a).forEach((function(e){return a[e].next=a[e].nextIds.map((function(e){return a[e]}))})),a[e.activityId]}a(40);var wt=function(e){Object(Le.a)(a,e);var t=Object(Be.a)(a);function a(e){var r;return Object(Re.a)(this,a),(r=t.call(this,e)).onImageLoad=function(e){r.setState({backgroundSize:{width:e.target.naturalWidth,height:e.target.naturalHeight}})},r.state={backgroundSize:{width:0,height:0}},r}return Object(_e.a)(a,[{key:"render",value:function(){var e=this.props,t=e.graphs,a=e.graphSize,r=e.backgroundImageUrl,n=this.state.backgroundSize,o=0,c=a.width/a.height,s=n.width/n.height,l=Math.max(400,a.height),d=Math.max(600,a.width);r&&(c-s>.05?l=d*(1/s):c-s<-.05&&(d=l*s));var u=Math.max(l-a.height,0)/2,p=Math.max(d-a.width,0)/2;return i.createElement("div",{className:"skill-graph-wrapper"},i.createElement("div",{className:"skill-graph-content ".concat(r?"has-background":"")},i.createElement("div",{className:"skill-graph-activities"},i.createElement("svg",{viewBox:"-".concat(p+40," -").concat(u+40," ").concat(d+80," ").concat(l+80),preserveAspectRatio:"xMidYMid meet"},t.map((function(e,t){return o+=e.height,i.createElement("g",{key:t,transform:"translate(0, ".concat(o-e.height,")")},i.createElement(yt,Object.assign({unit:bt},e)))})))),r&&i.createElement("div",{className:"skill-graph-background"},i.createElement("img",{src:r,alt:lf("Background Image"),onLoad:this.onImageLoad}))))}}]),a}(i.Component);var Ct=Object(l.b)((function(e,t){if(!e)return{};var a=t.maps.map((function(e){return gt(e)})),r=(null===a||void 0===a?void 0:a.length)?a.map((function(e){return e.width})).reduce((function(e,t){return Math.max(e,t)})):0,n=(null===a||void 0===a?void 0:a.length)?a.map((function(e){return e.height})).reduce((function(e,t){return e+t})):0;return{graphs:a,graphSize:{width:r,height:n}}}))(wt),xt=(a(41),le()?"http://localhost:3232/index.html":function(e){var t=/\/([\da-zA-Z\.]+)(?:--)?/i.exec(window.location.pathname);return"".concat(e.replace(/\/$/,""),"/").concat((null===t||void 0===t?void 0:t[1])||"")}(window.pxtTargetBundle.appTheme.embedUrl)),jt=function(e){Object(Le.a)(a,e);var t=Object(Be.a)(a);function a(e){var r;return Object(Re.a)(this,a),(r=t.call(this,e)).ref=void 0,r.messageQueue=[],r.finishedActivityState=void 0,r.nextId=0,r.pendingMessages={},r.isNewActivity=!1,r.sentReloadImportRequest=!1,r.handleFrameRef=function(e){if(e&&e.contentWindow){window.addEventListener("message",r.onMessageReceived),r.ref=e,r.ref.addEventListener("load",(function(){r.state.unloading&&(r.props.dispatchCloseActivity("finished"===r.finishedActivityState),r.props.dispatchUpdateUserCompletedTags(),r.finishedActivityState=void 0)})),At(".usabilla_live_button_container",!1),At("footer",!1);var t=document.getElementById("root");t&&pxt.BrowserUtils.addClass(t,"editor")}},r.onMessageReceived=function(e){var t=e.data;if(r.state.loaded||r.setState({loadPercent:Math.min((r.state.loadPercent||0)+4,95)}),"pxteditor"===t.type&&t.id&&r.pendingMessages[t.id])return r.onResponseReceived(r.pendingMessages[t.id],e.data),void delete r.pendingMessages[t.id];switch(t.action){case"event":r.handleEditorTickEvent(t);break;case"workspacesync":r.handleWorkspaceSyncRequest(t);break;case"workspacesave":r.handleWorkspaceSaveRequestAsync(t);break;case"workspaceevent":"createproject"===t.event.type&&r.handleWorkspaceReadyEventAsync()}},r.state={loaded:!1,unloading:!1,loadPercent:0},r}return Object(_e.a)(a,[{key:"componentDidUpdate",value:function(){var e=Object(W.a)(G.a.mark((function e(){var t;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.save&&this.sendMessage({type:"pxteditor",action:"saveproject",response:!1},!0),"reload"!==this.props.reload||this.sentReloadImportRequest){e.next=7;break}return this.sentReloadImportRequest=!0,e.next=5,$e(this.props.activityHeaderId);case 5:t=e.sent,this.sendMessage({type:"pxteditor",action:"importproject",project:t},!0);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){window.removeEventListener("message",this.onMessageReceived),At(".usabilla_live_button_container",!0),At("footer",!0);var e=document.getElementById("root");e&&pxt.BrowserUtils.removeClass(e,"editor")}},{key:"render",value:function(){var e=this.props,t=e.url,a=e.title,r=e.save,n=e.carryoverModalVisible,o=this.state,c=o.loaded,s=o.unloading,l=o.loadPercent,d=r?lf("Saving..."):lf("Loading...");return i.createElement("div",{className:"makecode-frame-outer"},i.createElement("div",{className:"makecode-frame-loader ".concat(!c||r||n?"":"hidden")},i.createElement("img",{src:de("assets/logo.svg"),alt:"MakeCode Logo"}),!c&&i.createElement("div",{className:"makecode-frame-loader-bar"},i.createElement("div",{className:"makecode-frame-loader-fill",style:{width:l+"%"}})),i.createElement("div",{className:"makecode-frame-loader-text"},d)),i.createElement("iframe",{className:"makecode-frame",src:s?"about:blank":t,title:a,ref:this.handleFrameRef}))}},{key:"onResponseReceived",value:function(e,t){var a=this.props.save;"saveproject"===e.action&&a&&("saving"===this.finishedActivityState?(this.finishedActivityState="finished",this.sendMessage({type:"pxteditor",action:"saveproject"},!0)):this.setState({unloading:!0})),"importproject"===e.action&&("reload"===this.props.reload?this.props.dispatchSetReloadHeaderState("active"):this.onEditorLoaded())}},{key:"sendMessage",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=function(e){a&&(e.response=!0,e.id=t.nextId+++"",t.pendingMessages[e.id]=e),t.ref.contentWindow.postMessage(e,"*")};if(this.ref)if(this.ref.contentWindow){for(;this.messageQueue.length;)r(this.messageQueue.shift());r(e)}else this.messageQueue.push(e)}},{key:"handleWorkspaceSyncRequest",value:function(e){this.sendMessage(Object(p.a)(Object(p.a)({},e),{},{success:!0,projects:[]}))}},{key:"handleWorkspaceSaveRequestAsync",value:function(){var e=Object(W.a)(G.a.mark((function e(t){var a,r,n,i,o,c,s,l,d,u,v,m,h;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props,n=r.dispatchSetHeaderIdForActivity,i=r.activityHeaderId,o=r.activityType,c=r.title,s=r.mapId,l=r.activityId,d=Object(p.a)(Object(p.a)({},t.project),{},{header:Object(p.a)(Object(p.a)({},t.project.header),{},{id:i||t.project.header.id})}),(null===(a=d.header)||void 0===a?void 0:a.name)!==c&&(d.header.name=c,(u=d.text["pxt.json"])&&((v=JSON.parse(u)).name=c,d.text["pxt.json"]=pxt.Package.stringifyConfig(v))),!d.header.tutorialCompleted){e.next=8;break}return e.next=6,$e(d.header.id);case 6:(null===(h=e.sent)||void 0===h||null===(m=h.header)||void 0===m?void 0:m.tutorial)&&(d.header.tutorial=h.header.tutorial,d.header.tutorial.tutorialStep=d.header.tutorialCompleted.steps-1,delete d.header.tutorialCompleted);case 8:if("tutorial"===o&&!d.header.tutorial&&!d.header.tutorialCompleted||this.props.reload){e.next=11;break}return e.next=11,Ze(d);case 11:d.header.tutorial?n(s,l,d.header.id,(d.header.tutorial.tutorialStep||0)+1,d.header.tutorial.tutorialStepInfo.length,!1):d.header.tutorialCompleted&&n(s,l,d.header.id,d.header.tutorialCompleted.steps,d.header.tutorialCompleted.steps,!0);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleWorkspaceReadyEventAsync",value:function(){var e=Object(W.a)(G.a.mark((function e(){var t;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.activityHeaderId){e.next=7;break}return e.next=3,$e(this.props.activityHeaderId);case 3:t=e.sent,this.sendMessage({type:"pxteditor",action:"importproject",project:t},!0),e.next=9;break;case 7:this.isNewActivity=!0,this.sendMessage({type:"pxteditor",action:"startactivity",path:this.props.tutorialPath,activityType:"tutorial"},!0);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleEditorTickEvent",value:function(e){switch(e.tick){case"tutorial.editorLoaded":this.onEditorLoaded();break;case"tutorial.complete":this.onTutorialFinished()}}},{key:"onEditorLoaded",value:function(){var e=this.props,t=e.mapId,a=e.activityId,r=e.showCodeCarryoverModal;pe("skillmap.activity.loaded",{path:t,activity:a}),this.setState({loaded:!0}),this.isNewActivity&&(this.isNewActivity=!1,r&&this.props.dispatchShowCarryoverModal(t,a))}},{key:"onTutorialFinished",value:function(){var e=this.props;pe("skillmap.activity.complete",{path:e.mapId,activity:e.activityId}),this.finishedActivityState="saving",this.props.dispatchSaveAndCloseActivity()}}]),a}(i.Component);function At(e,t){var a=document.querySelector(e);(null===a||void 0===a?void 0:a.style)&&(a.style.display=t?"":"none")}var Nt={dispatchSetHeaderIdForActivity:function(e,t,a,r,n,i){return{type:b,mapId:e,activityId:t,id:a,currentStep:r,maxSteps:n,isCompleted:i}},dispatchCloseActivity:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{type:I,finished:e}},dispatchSaveAndCloseActivity:De,dispatchUpdateUserCompletedTags:function(){return{type:w}},dispatchShowCarryoverModal:function(e,t){return{type:H,mapId:e,activityId:t}},dispatchSetReloadHeaderState:Fe},Mt=Object(l.b)((function(e,t){var a,r;if(!e||!e.editorView)return{};var n,i=e.editorView,o=i.currentActivityId,c=i.currentMapId,s=i.currentHeaderId,l=i.state,d=xt,u=e.maps[c],p=u.activities[o];"/"!==xt.charAt(xt.length-1)||le()||(d=xt.substr(0,xt.length-1)),d+="?controller=1&skillsMap=1&noproject=1&nocookiebanner=1",n=p.displayName;var v=Ee(e.user,e.pageSourceUrl,u,p.activityId).some((function(e){return(null===e||void 0===e?void 0:e.isCompleted)&&e.maxSteps===e.currentStep}));return{url:d,tutorialPath:p.url,title:n,mapId:c,activityId:o,activityHeaderId:s,completed:null===(a=Ie(e.user,e.pageSourceUrl,c,o))||void 0===a?void 0:a.isCompleted,activityType:p.type,showCodeCarryoverModal:p.allowCodeCarryover&&v,carryoverModalVisible:"carryover"===(null===(r=e.modal)||void 0===r?void 0:r.type),save:"saving"===l,reload:"reload"===l||"reloading"===l?l:void 0}}),Nt)(jt),Tt=function(e){Object(Le.a)(a,e);var t=Object(Be.a)(a);function a(){var e;Object(Re.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).handleActionButtonClick=function(){var t=e.props,a=t.status,r=t.mapId,n=t.activityId,i=t.dispatchOpenActivity;switch(a){case"locked":break;case"completed":case"inprogress":case"notstarted":case"restarted":default:return pe("skillmap.activity.open",{path:r,activity:n,status:a||""}),i(r,n)}},e.handleRestartButtonClick=function(){var t=e.props,a=t.mapId,r=t.activityId,n=t.status,i=t.dispatchShowRestartActivityWarning;pe("skillmap.sidebar.restart",{path:a,activity:r,status:n||""}),i(a,r)},e.handleShareButtonClick=function(){var t=e.props,a=t.mapId,r=t.activityId,n=t.status,i=t.dispatchShowShareModal;pe("skillmap.sidebar.share",{path:a,activity:r,status:n||""}),i(a,r)},e.handleSaveToProjectsClick=function(){var t=e.props,a=t.completedHeaderId;pe("skillmap.export",{path:t.mapId||"",activity:t.activityId||""}),window.open("".concat(xt,"#skillmapimport:").concat(a))},e}return Object(_e.a)(a,[{key:"getActivityActionText",value:function(){switch(this.props.status){case"locked":return lf("LOCKED");case"completed":return lf("VIEW CODE");case"inprogress":case"restarted":return lf("CONTINUE");case"notstarted":default:return lf("START")}}},{key:"isCompleted",value:function(e){return"completed"===e||"restarted"===e}},{key:"render",value:function(){var e=this.props,t=e.status,a=e.completedHeaderId,r=t&&"notstarted"!==t&&"locked"!==t;return"locked"===t?i.createElement("div",null):i.createElement("div",{className:"actions ".concat(a?"grid":"")},i.createElement("div",{className:"action-button",role:"button",onClick:this.handleActionButtonClick},this.getActivityActionText()),r&&i.createElement("div",{className:"action-button",role:"button",onClick:this.handleRestartButtonClick},lf("Restart")),r&&i.createElement("div",{className:"action-button",role:"button",onClick:this.handleShareButtonClick},lf("Share")),a&&i.createElement("div",{className:"action-button",role:"button",onClick:this.handleSaveToProjectsClick},lf("Save to My Projects")))}}]),a}(i.Component),Ut={dispatchOpenActivity:He,dispatchShowRestartActivityWarning:function(e,t){return{type:_,mapId:e,activityId:t}},dispatchShowShareModal:function(e,t){return{type:D,mapId:e,activityId:t}}},Pt=Object(l.b)(null,Ut)(Tt),Rt=function(e){Object(Le.a)(a,e);var t=Object(Be.a)(a);function a(){var e;Object(Re.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).handleActionButtonClick=function(){var t=e.props,a=t.status,r=t.mapId,n=t.activityId,i=t.dispatchShowCompletionModal;switch(a){case"locked":break;default:return pe("skillmap.sidebar.reward",{path:r,activity:n}),i(r,n)}},e}return Object(_e.a)(a,[{key:"getRewardActionText",value:function(){switch(this.props.type){case"certificate":return lf("Claim Certificate");default:return lf("Claim Reward")}}},{key:"render",value:function(){return"locked"===this.props.status?i.createElement("div",null):i.createElement("div",{className:"actions"},i.createElement("div",{className:"action-button",role:"button",onClick:this.handleActionButtonClick},this.getRewardActionText()))}}]),a}(i.Component),_t={dispatchOpenActivity:He,dispatchShowCompletionModal:Ve},Lt=Object(l.b)(null,_t)(Rt),Bt=(a(42),function(e){Object(Le.a)(a,e);var t=Object(Be.a)(a);function a(){return Object(Re.a)(this,a),t.apply(this,arguments)}return Object(_e.a)(a,[{key:"getStatusLabel",value:function(e){switch(e){case"locked":return lf("Locked");case"completed":return lf("Completed");default:return null}}},{key:"getStatusIcon",value:function(e){switch(e){case"locked":return"lock";case"completed":return"check circle";default:return null}}},{key:"render",value:function(){var e=this.props,t=e.mapId,a=e.title,r=e.subtitle,n=e.description,o=e.infoUrl,c=e.imageUrl,s=e.details,l=e.node,d=e.status,u=e.completedHeaderId,p=this.getStatusLabel(d),v=!l,m=l&&!we(l),h=m&&l.tags||void 0;return i.createElement("div",{className:"info-panel"},i.createElement("div",{className:"info-panel-image"},c?i.createElement("img",{src:c,alt:lf("Preview of activity content")}):i.createElement("i",{className:"icon image"})),i.createElement("div",{className:"info-panel-content"},r&&i.createElement("div",{className:"info-panel-subtitle"},r),i.createElement("div",{className:"info-panel-title"},a),p&&i.createElement("div",{className:"info-panel-label"},i.createElement("i",{className:"ui icon ".concat(this.getStatusIcon(d))}),i.createElement("span",null,p)),i.createElement("div",{className:"info-panel-description"},n),v&&o&&i.createElement("a",{className:"info-panel-link",href:o,target:"_blank",rel:"noopener noreferrer"},lf("Learning Outcomes")),h&&h.length>0&&i.createElement("div",{className:"info-panel-tags"},h.map((function(e,t){return i.createElement("div",{key:t},e)}))),i.createElement("div",{className:"info-panel-detail"},null===s||void 0===s?void 0:s.map((function(e,t){return i.createElement("div",{key:"detail_".concat(t)},e)}))),i.createElement("div",{className:"tablet-spacer"}),!v&&(m?i.createElement(Pt,{mapId:t,activityId:l.activityId,status:d,completedHeaderId:u}):i.createElement(Lt,{mapId:t,activityId:l.activityId,status:d,type:l.type}))))}}]),a}(i.Component));var Ht=Object(l.b)((function(e,t){var a,r,n,i,o=e.user,c=e.pageSourceUrl,s=e.maps,l=e.selectedItem,d=e.infoUrl,u=l&&(null===(a=e.maps[l.mapId])||void 0===a?void 0:a.activities[l.activityId]),p="activity"===(null===u||void 0===u?void 0:u.kind),v=[];if(s)if((null===l||void 0===l?void 0:l.activityId)&&s[l.mapId]){var m=s[l.mapId],h=fe(e.user,e.pageSourceUrl,m,l.activityId),f=h.status,y=h.currentStep,b=h.maxSteps;r=f,i=h.completedHeadedId,p&&(v.push(b?"".concat(y,"/").concat(b," ").concat(lf("Steps")):lf("Not Started")),v.push(p?u.type:"")),m&&(n=m.displayName)}else if(o){var g=Object.keys(s),I=0,k=0,E=0,O=0;g.forEach((function(e){var t=s[e].activities;Object.keys(t).filter((function(e){return"activity"==t[e].kind})).forEach((function(t){return++k&&he(o,c,e,t)&&++I})),Object.keys(t).filter((function(e){return we(t[e])})).forEach((function(t){return++O&&he(o,c,e,t)&&++E}))})),v.push("".concat(I,"/").concat(k," ").concat(lf("Complete"))),v.push(O?"".concat(E,"/").concat(O," ").concat(lf("Reward(s)")):"")}return{mapId:null===l||void 0===l?void 0:l.mapId,title:(null===u||void 0===u?void 0:u.displayName)||e.title,subtitle:n,description:p?u.description:e.description,infoUrl:d,imageUrl:u?null===u||void 0===u?void 0:u.imageUrl:e.bannerImageUrl,node:u,status:r,details:v,completedHeaderId:i}}))(Bt);function Dt(e){for(var t,a=function(e){var t,a=e.split("\n"),r=[],n=null,i=null,o=null,c=Object(ve.a)(a);try{for(c.s();!(t=c.n()).done;){var s=t.value;if(s.trim()){if(s.startsWith("#")){var l=/^(#+)\s*(.+)$/.exec(s);if(l){u(),n={headerKind:1===l[1].length?"single":2===l[1].length?"double":"triple",header:l[2],attributes:{}},i=null,o=null;continue}}if(n){var d=/^[*-]\s+(?:([^:]+):)?(.*)$/.exec(s);d&&(d[1]?(i&&o&&(n.attributes[i]=o.trim()),i=d[1].toLowerCase(),o=d[2]):i&&(o+=d[2]))}}else o&&(o+="\n")}}catch(p){c.e(p)}finally{c.f()}return u(),r;function u(){n&&(i&&o&&(n.attributes[i]=o.trim()),r.push(n))}}(e),r=[],n=-1,i=0;i<a.length;i++)"single"===a[i].headerKind?t=Wt(a[i]):"double"===a[i].headerKind&&(n>=0&&r.push(Ft(a[n],a.slice(n+1,i))),n=i);return(n>0||0===r.length)&&r.push(Ft(a[n],a.slice(n+1,a.length))),{maps:r,metadata:t}}function Ft(e,t){var a=function(e){var t={mapId:e.header.toLowerCase(),displayName:e.attributes.name||e.header,description:e.attributes.description,completionUrl:e.attributes.completionurl,prerequisites:[],activities:{},allowCodeCarryover:!e.attributes.allowcodecarryover||!Gt(e.attributes.allowcodecarryover)};if(e.attributes.required){var a,r=e.attributes.required.split(","),n=Object(ve.a)(r);try{for(n.s();!(a=n.n()).done;){var i=a.value,o=/^\s*(?:(\d+) +)?(.+)$/.exec(i);o[1]?t.prerequisites.push({type:"tag",tag:o[2].trim(),numberCompleted:parseInt(o[1])}):t.prerequisites.push({type:"map",mapId:o[2].trim()})}}catch(c){n.e(c)}finally{n.f()}}return t}(e),r=t.map(Vt),n=r.filter((function(e){return"activity"===e.kind}));a.allowCodeCarryover&&n.forEach((function(e){void 0===e.allowCodeCarryover&&(e.allowCodeCarryover=!0)})),a.root=r[0];var i,o=Object(ve.a)(r);try{for(o.s();!(i=o.n()).done;){var c=i.value;a.activities[c.activityId]&&zt("Duplicate activity id '".concat(c.activityId,"' in map '").concat(a.mapId,"'")),a.activities[c.activityId]=c}}catch(g){o.e(g)}finally{o.f()}var s,l=Object(ve.a)(r);try{for(l.s();!(s=l.n()).done;){var d,u=s.value,v=Object(ve.a)(u.nextIds);try{for(v.s();!(d=v.n()).done;){var m=d.value;a.activities[m]||zt("Unknown activity id '".concat(m,"' in map '").concat(a.mapId,"'")),u.next.push(a.activities[m])}}catch(g){v.e(g)}finally{v.f()}}}catch(g){l.e(g)}finally{l.f()}var h={};!function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r[t.activityId]&&zt("Loop in map '".concat(a.mapId,"' detected"));r[t.activityId]=!0,h[t.activityId]=!0;var n,i=Object(ve.a)(t.next);try{for(i.s();!(n=i.n()).done;){var o=n.value;e(o,Object(p.a)({},r))}}catch(g){i.e(g)}finally{i.f()}}(a.root);var f,y=Object(ve.a)(r);try{for(y.s();!(f=y.n()).done;){var b=f.value;h[b.activityId]||console.warn("Unreachable activity detected '".concat(b.activityId,"' in map '").concat(a.mapId,"'"))}}catch(g){y.e(g)}finally{y.f()}return a}function Vt(e){var t={activityId:e.header.toLowerCase(),imageUrl:e.attributes.imageurl,next:[],displayName:e.attributes.name||e.header,nextIds:Yt(e.attributes.next)};return"reward"===e.attributes.kind||"completion"===e.attributes.kind?function(e,t){var a=Object(p.a)(Object(p.a)({},t),{},{kind:e.attributes.kind||"reward",url:e.attributes.url});if(e.attributes.type){var r=e.attributes.type.toLowerCase();switch(r){case"certificate":a.type=r}}return a}(e,t):"layout"===e.attributes.kind?function(e,t){return Object(p.a)(Object(p.a)({},t),{},{kind:"layout",next:[]})}(0,t):function(e,t){var a=Object(p.a)(Object(p.a)({},t),{},{kind:"activity",description:e.attributes.description,url:e.attributes.url,tags:Yt(e.attributes.tags),allowCodeCarryover:!e.attributes.allowcodecarryover||!Gt(e.attributes.allowcodecarryover)});if(e.attributes.type){var r=e.attributes.type.toLowerCase();switch(r){case"tutorial":a.type=r}}if(e.attributes.editor){var n=e.attributes.editor.toLowerCase();switch(n){case"py":case"blocks":case"js":a.editor=n;break;default:a.editor="blocks"}}a.url||zt("Activity '".concat(a.activityId,"' is missing attribute 'url'"));a.type||zt("Activity '".concat(a.activityId,"' is missing attribute 'type'"));return a}(e,t)}function Gt(e){if(!e)return!1;switch(e.toLowerCase().trim()){case"0":case"no":case"n":case"off":case"false":return!0;default:return!1}}function Wt(e){var t=e.attributes.primarycolor,a=e.attributes.secondarycolor,r=e.attributes.tertiarycolor,n=e.attributes.highlightcolor,i=e.attributes.unlockednodecolor,o=e.attributes.lockednodecolor,c=e.attributes.completednodecolor;return{title:e.attributes.name||e.header,description:e.attributes.description,infoUrl:Jt(e.attributes.infourl),backgroundImageUrl:e.attributes.backgroundurl,bannerImageUrl:e.attributes.bannerurl,alternateSources:Yt(e.attributes.alternatesources),theme:{backgroundColor:r||"var(--body-background-color)",pathColor:t||"#BFBFBF",strokeColor:"#000000",rewardNodeColor:n||"var(--primary-color)",rewardNodeForeground:n?qt(n):"#000000",unlockedNodeColor:i||a||"var(--secondary-color)",unlockedNodeForeground:i||a?qt(i||a):"#000000",lockedNodeColor:o||t||"#BFBFBF",lockedNodeForeground:o||t?qt(o||t):"#000000",completedNodeColor:c||a||"var(--secondary-color)",completedNodeForeground:c||a?qt(c||a):"#000000",selectedStrokeColor:n||"var(--primary-color)",pathOpacity:.5}}}function qt(e){return e=e.replace("#",""),Number.parseInt(e.slice(0,2),16)+Number.parseInt(e.slice(2,4),16)+Number.parseInt(e.slice(4),16)>382.5?"#000000":"#ffffff"}function Jt(e){if(e)return e.match(/^(https?:\/\/)?(www\.)?github\.com\//gi)?e.replace(/\?[\s\S]+$/gi,""):e.indexOf(".")<0?"".concat(e.startsWith("/")?"":"/").concat(e):void zt("Educator info URL must be to Github or MakeCode documentation")}function Yt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return[];var a=e.split(",").map((function(e){return e.trim().toLowerCase()})).filter((function(e){return!!e}));if(!t){var r={};return a.forEach((function(e){return r[e]=e})),Object.keys(r)}return a}function zt(e){throw e}a(43),a(44);var Kt=function(e){Object(Le.a)(a,e);var t=Object(Be.a)(a);function a(e){var r;return Object(Re.a)(this,a),(r=t.call(this,e)).queryFlags={},r.unsubscribeChangeListener=void 0,r.loadedUser=void 0,r.handleHashChange=function(){var e=Object(W.a)(G.a.mark((function e(t){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.parseHashAsync();case 2:t.stopPropagation(),t.preventDefault();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.handleError=function(e){var t=e||lf("Oops! Couldn't load content, please check the URL and markdown file.");console.error(t),r.setState({error:t})},r.onStoreChange=Object(W.a)(G.a.mark((function e(){var t,a;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Pe.getState(),(a=t.user)===r.loadedUser||r.loadedUser&&a.id!==r.loadedUser.id){e.next=5;break}return e.next=4,rt(a);case 4:r.loadedUser=a;case 5:case"end":return e.stop()}}),e)}))),r.state={},window.addEventListener("hashchange",r.handleHashChange),r}return Object(_e.a)(a,[{key:"parseHashAsync",value:function(){var e=Object(W.a)(G.a.mark((function e(){var t,a,r,n,i,o;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pxt.targetConfigAsync();case 2:return r=e.sent,i=window.location.hash.replace("#",""),n=i&&(null===(t=r.skillMap)||void 0===t||null===(a=t.pathAliases)||void 0===a?void 0:a[i])?J(r.skillMap.pathAliases[i]):J(window.location.hash||(null===(o=r.skillMap)||void 0===o?void 0:o.defaultPath)),e.next=7,this.fetchAndParseSkillMaps(n.cmd,n.arg);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initLocalizationAsync",value:function(){var e=Object(W.a)(G.a.mark((function e(){var t,a,r,n,i,o,c,s;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=pxt.appTarget.appTheme,a=window.location.href,r=!1,n=void 0,/[&?]translate=1/.test(a)&&!pxt.BrowserUtils.isIE()?n=ts.pxtc.Util.TRANSLATION_LOCALE:((i=/(live)?(force)?lang=([a-z]{2,}(-[A-Z]+)?)/i.exec(window.location.href))&&window.location.hash.indexOf(i[0])>=0&&pxt.BrowserUtils.changeHash(window.location.hash.replace(i[0],"")),n=i?i[3]:pxt.BrowserUtils.getCookieLang()||t.defaultLocale||navigator.userLanguage||navigator.language,r=!!i&&!!i[2]),"",o=pxt.appTarget.id,c=pxt.appTarget.versions.pxtCrowdinBranch,s=pxt.appTarget.versions.targetCrowdinBranch,pxt.BrowserUtils.isLocalHostDev()&&(pxt.appTarget.appTheme.defaultLocale||"en")===n||pxt.BrowserUtils.isPxtElectron()||pxt.Util.enableLiveLocalizationUpdates(),e.next=12,Xt({targetId:o,baseUrl:"",code:n,pxtBranch:c,targetBranch:s,force:r});case 12:pxt.Util.isLocaleEnabled(n)&&pxt.BrowserUtils.setCookieLang(n);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchAndParseSkillMaps",value:function(){var e=Object(W.a)(G.a.mark((function e(t,a){var n,i,o,c,s,l,d,u,p,v,m,h,f,y,b,g,I=this;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(t,a);case 2:if(n=e.sent,i=null===n||void 0===n?void 0:n.text,o=null===n||void 0===n?void 0:n.identifier,c=null===n||void 0===n?void 0:n.status,i&&o&&c)try{"banned"===c?this.handleError(lf("This GitHub repository has been banned.")):(ue(o),this.props.dispatchSetPageSourceUrl(o,c),this.props.dispatchClearMetadata()),l=Dt(i),d=l.maps,u=l.metadata,(null===d||void 0===d?void 0:d.length)>0&&(s=d,this.props.dispatchClearSkillMaps(),d.forEach((function(e){I.props.dispatchAddSkillMap(e)}))),u&&(p=u.title,v=u.description,m=u.infoUrl,h=u.backgroundImageUrl,f=u.bannerImageUrl,y=u.theme,b=u.alternateSources,r=p,this.props.dispatchSetPageTitle(p),v&&this.props.dispatchSetPageDescription(v),m&&this.props.dispatchSetPageInfoUrl(m),h&&this.props.dispatchSetPageBackgroundImageUrl(h),f&&this.props.dispatchSetPageBannerImageUrl(f),b&&this.props.dispatchSetPageAlternateUrls(b),y&&this.props.dispatchSetPageTheme(y)),this.setState({error:void 0})}catch(k){this.handleError(k)}else this.setState({error:lf("No content loaded.")});return e.next=9,tt();case 9:(g=e.sent)||(g={id:se(),completedTags:{},mapProgress:{},version:pxt.skillmap.USER_VERSION}),o&&!g.completedTags[o]&&(g.completedTags[o]={}),this.applyQueryFlags(g,s,o),this.loadedUser=g,this.props.dispatchSetUser(g);case 15:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(W.a)(G.a.mark((function e(){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.unsubscribeChangeListener=Pe.subscribe(this.onStoreChange),this.queryFlags=Y(),e.next=4,this.initLocalizationAsync();case 4:return e.next=6,this.parseHashAsync();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){window.removeEventListener("hashchange",this.handleHashChange),this.unsubscribeChangeListener&&this.unsubscribeChangeListener()}},{key:"render",value:function(){var e=this.props,t=e.skillMaps,a=e.activityOpen,r=e.backgroundImageUrl,n=e.theme,i=this.state.error,c=Object.keys(t).map((function(e){return t[e]}));return o.a.createElement("div",{className:"app-container ".concat(pxt.appTarget.id)},o.a.createElement(Ke,null),a?o.a.createElement(Mt,null):o.a.createElement("div",{className:"skill-map-container",style:{backgroundColor:n.backgroundColor}},i?o.a.createElement("div",{className:"skill-map-error"},i):o.a.createElement(Ct,{maps:c,backgroundImageUrl:r}),!i&&o.a.createElement(Ht,null)),o.a.createElement(pt,null))}},{key:"applyQueryFlags",value:function(e,t,a){var r=a||"default";if("true"===this.queryFlags.debugNewUser&&(e.isDebug=!0,e.mapProgress=Object(u.a)({},r,{}),e.completedTags={}),"true"===this.queryFlags.debugCompleted&&(e.isDebug=!0,e.mapProgress=Object(u.a)({},r,{}),t)){var n,i=Object(ve.a)(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;e.mapProgress[r][o.mapId]={completionState:"completed",mapId:o.mapId,activityState:{}};for(var c=0,s=Object.keys(o.activities);c<s.length;c++){var l,d=s[c],p=o.activities[d];if(e.mapProgress[r][o.mapId].activityState[p.activityId]?e.mapProgress[r][o.mapId].activityState[p.activityId].isCompleted=!0:e.mapProgress[r][o.mapId].activityState[p.activityId]={activityId:p.activityId,isCompleted:!0},"activity"===p.kind&&(null===(l=p.tags)||void 0===l?void 0:l.length)&&a){var v,m=Object(ve.a)(p.tags);try{for(m.s();!(v=m.n()).done;){var h=v.value;e.completedTags[a][h]||(e.completedTags[a][h]=0),e.completedTags[a][h]++}}catch(f){m.e(f)}finally{m.f()}}}}}catch(f){i.e(f)}finally{i.f()}}}}]),a}(o.a.Component);function Xt(e){return $t.apply(this,arguments)}function $t(){return($t=Object(W.a)(G.a.mark((function e(t){var a,r,n,i,o,c;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.targetId,r=t.baseUrl,n=t.pxtBranch,i=t.targetBranch,t.force,o=t.code,e.next=4,pxt.Util.downloadTranslationsAsync(a,r,o,n,i,pxt.Util.liveLocalizationEnabled(),ts.pxtc.Util.TranslationsKind.SkillMap);case 4:c=e.sent,pxt.Util.setUserLanguage(o),c&&pxt.Util.setLocalizedStrings(c);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Qt={dispatchAddSkillMap:function(e){return{type:v,map:e}},dispatchClearSkillMaps:function(){return{type:m}},dispatchClearMetadata:function(){return{type:h}},dispatchSetPageTitle:function(e){return{type:x,title:e}},dispatchSetPageDescription:function(e){return{type:j,description:e}},dispatchSetPageInfoUrl:function(e){return{type:A,infoUrl:e}},dispatchSetUser:function(e){return{type:S,user:e}},dispatchSetPageSourceUrl:function(e,t){return{type:U,url:e,status:t}},dispatchSetPageAlternateUrls:function(e){return{type:P,urls:e}},dispatchSetPageBackgroundImageUrl:function(e){return{type:N,backgroundImageUrl:e}},dispatchSetPageBannerImageUrl:function(e){return{type:M,bannerImageUrl:e}},dispatchSetPageTheme:function(e){return{type:T,theme:e}}},Zt=Object(l.b)((function(e,t){return e?{skillMaps:e.maps,activityOpen:!!e.editorView,backgroundImageUrl:e.backgroundImageUrl,theme:e.theme}:{}}),Qt)(Kt),ea=window.pxtTargetBundle;ea.bundledpkgs={},pxt.setAppTarget(ea),pxt.Cloud.apiRoot="https://www.makecode.com/api/",s.a.render(o.a.createElement(l.a,{store:Pe},o.a.createElement(Zt,null)),document.getElementById("root"))}},[[45,1,2]]]);