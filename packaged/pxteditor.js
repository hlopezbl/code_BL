var pxt;!function(e){!function(t){let o,i,r,s;!function(e){e[e.Stopped=0]="Stopped",e[e.Pending=1]="Pending",e[e.Starting=2]="Starting",e[e.Running=3]="Running"}(o=t.SimState||(t.SimState={})),t.isBlocks=function(t){return e.U.endsWith(t.name,".blocks")},function(e){e.HeaderOnly="errorListHeader",e.Expanded="errorListExpanded"}(i=t.ErrorListState||(t.ErrorListState={})),function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible",e[e.Disabled=2]="Disabled"}(r=t.FilterState||(t.FilterState={})),t.initExtensionsAsync=e=>Promise.resolve({}),t.initFieldExtensionsAsync=e=>Promise.resolve({}),t.HELP_IMAGE_URI="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjYiIGhlaWdodD0iMjYiIHZpZXdCb3g9IjAgMCAyNiAyNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTMiIGN5PSIxMyIgcj0iMTMiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xNy45NTIgOS4xODQwMkMxNy45NTIgMTAuMjU2IDE3LjgxNiAxMS4wNzIgMTcuNTQ0IDExLjYzMkMxNy4yODggMTIuMTkyIDE2Ljc1MiAxMi43OTIgMTUuOTM2IDEzLjQzMkMxNS4xMiAxNC4wNzIgMTQuNTc2IDE0LjU4NCAxNC4zMDQgMTQuOTY4QzE0LjA0OCAxNS4zMzYgMTMuOTIgMTUuNzM2IDEzLjkyIDE2LjE2OFYxNi45NkgxMS44MDhDMTEuNDI0IDE2LjQ2NCAxMS4yMzIgMTUuODQgMTEuMjMyIDE1LjA4OEMxMS4yMzIgMTQuNjg4IDExLjM4NCAxNC4yODggMTEuNjg4IDEzLjg4OEMxMS45OTIgMTMuNDg4IDEyLjUzNiAxMi45NjggMTMuMzIgMTIuMzI4QzE0LjEwNCAxMS42NzIgMTQuNjI0IDExLjE2OCAxNC44OCAxMC44MTZDMTUuMTM2IDEwLjQ0OCAxNS4yNjQgOS45NjgwMiAxNS4yNjQgOS4zNzYwMkMxNS4yNjQgOC4yMDgwMiAxNC40MTYgNy42MjQwMiAxMi43MiA3LjYyNDAyQzExLjc2IDcuNjI0MDIgMTAuNzUyIDcuNzM2MDIgOS42OTYgNy45NjAwMkw5LjE0NCA4LjA4MDAyTDkgNi4wODgwMkMxMC40ODggNS41NjAwMiAxMS44NCA1LjI5NjAyIDEzLjA1NiA1LjI5NjAyQzE0LjczNiA1LjI5NjAyIDE1Ljk2OCA1LjYwODAyIDE2Ljc1MiA2LjIzMjAyQzE3LjU1MiA2Ljg0MDAyIDE3Ljk1MiA3LjgyNDAyIDE3Ljk1MiA5LjE4NDAyWk0xMS40IDIyVjE4LjY0SDE0LjE4NFYyMkgxMS40WiIgZmlsbD0iIzU5NUU3NCIvPgo8L3N2Zz4K",t.initEditorExtensionsAsync=function(){if(!s&&(s=Promise.resolve(),e.appTarget&&e.appTarget.appTheme&&e.appTarget.appTheme.extendFieldEditors)){const t={};s=s.then((()=>e.BrowserUtils.loadBlocklyAsync())).then((()=>e.BrowserUtils.loadScriptAsync("fieldeditors.js"))).then((()=>e.editor.initFieldExtensionsAsync(t))).then((t=>{t.fieldEditors&&t.fieldEditors.forEach((t=>{e.blocks.registerFieldEditor(t.selector,t.editor,t.validator)}))}))}return s}}(e.editor||(e.editor={}))}(pxt||(pxt={})),function(e){!function(t){const o={};function i(e,t,o,i){e.response&&window.parent.postMessage({type:e.type,id:e.id,resp:t,success:o,error:i},"*")}function r(t){return new Promise(((i,r)=>{const s=e.Util.clone(t);s.id=ts.pxtc.Util.guidGen(),t.response&&(o[s.id]={resolve:i,reject:r}),window.parent.postMessage(s,"*"),t.response||i(void 0)}))}t.bindEditorMessages=function(t){const r=(e.appTarget.appTheme.allowParentController||e.shell.isControllerMode())&&e.BrowserUtils.isIFrame(),s=e.appTarget.appTheme.allowPackageExtensions,n=e.appTarget.appTheme.allowSimulatorTelemetry;(r||s||n)&&window.addEventListener("message",(a=>{const l=a.data;if(!l||!/^pxt(host|editor|pkgext|sim)$/.test(l.type))return!1;if("pxtpkgext"===l.type&&s)t().then((e=>{e.handleExtensionRequest(l)}));else if("pxtsim"===l.type&&n){const t=l;"event"===t.action&&(t.category||t.message?e.reportError(t.category,t.message,t.data):e.tickEvent(t.tick,t.data))}else if(r){let r,s=Promise.resolve();if("pxthost"==l.type){const t=o[l.id];t?s=s.then((()=>t.resolve(l))):e.debug(`pxthost: unknown request ${l.id}`)}else"pxteditor"==l.type&&(s=s.then((()=>t().then((t=>{const o=l;switch(e.debug(`pxteditor: ${o.action}`),o.action.toLowerCase()){case"switchjavascript":return Promise.resolve().then((()=>t.openJavaScript()));case"switchpython":return Promise.resolve().then((()=>t.openPython()));case"switchblocks":return Promise.resolve().then((()=>t.openBlocks()));case"startsimulator":return Promise.resolve().then((()=>t.startSimulator()));case"restartsimulator":return Promise.resolve().then((()=>t.restartSimulator()));case"hidesimulator":return Promise.resolve().then((()=>t.collapseSimulator()));case"showsimulator":return Promise.resolve().then((()=>t.expandSimulator()));case"closeflyout":return Promise.resolve().then((()=>t.closeFlyout()));case"saveproject":return t.saveProjectAsync();case"redo":return Promise.resolve().then((()=>{const e=t.editor;e&&e.hasRedo()&&e.redo()}));case"undo":return Promise.resolve().then((()=>{const e=t.editor;e&&e.hasUndo()&&e.undo()}));case"setscale":{const e=l;return Promise.resolve().then((()=>t.editor.setScale(e.scale)))}case"stopsimulator":{const e=l;return Promise.resolve().then((()=>t.stopSimulator(e.unload)))}case"newproject":{const e=l;return Promise.resolve().then((()=>t.newProject(e.options)))}case"importproject":{const e=l;return Promise.resolve().then((()=>t.importProjectAsync(e.project,{filters:e.filters,searchBar:e.searchBar})))}case"startactivity":{const o=l;let i,r=o.path;return/^([jt]s|py|blocks?):/i.test(r)&&(i=/^py:/i.test(r)?e.PYTHON_PROJECT_NAME:/^[jt]s:/i.test(r)?e.JAVASCRIPT_PROJECT_NAME:e.BLOCKS_PROJECT_NAME,r=r.substr(r.indexOf(":")+1)),Promise.resolve().then((()=>t.startActivity(o.activityType,r,void 0,i)))}case"importtutorial":{const e=l;return Promise.resolve().then((()=>t.importTutorialAsync(e.markdown)))}case"proxytosim":{const e=l;return Promise.resolve().then((()=>t.proxySimulatorMessage(e.content)))}case"renderblocks":{const e=l;return Promise.resolve().then((()=>t.renderBlocksAsync(e))).then((e=>e.xml.then((e=>{r=e.xml}))))}case"renderpython":{const e=l;return Promise.resolve().then((()=>t.renderPythonAsync(e))).then((e=>{r=e.python}))}case"toggletrace":{const e=l;return Promise.resolve().then((()=>t.toggleTrace(e.intervalSpeed)))}case"settracestate":{const e=l;return Promise.resolve().then((()=>t.setTrace(e.enabled,e.intervalSpeed)))}case"setsimulatorfullscreen":{const e=l;return Promise.resolve().then((()=>t.setSimulatorFullScreen(e.enabled)))}case"togglehighcontrast":return Promise.resolve().then((()=>t.toggleHighContrast()));case"togglegreenscreen":return Promise.resolve().then((()=>t.toggleGreenScreen()));case"print":return Promise.resolve().then((()=>t.printCode()));case"pair":return t.pairAsync();case"info":return Promise.resolve().then((()=>{r={versions:e.appTarget.versions,locale:ts.pxtc.Util.userLanguage(),availableLocales:e.appTarget.appTheme.availableLocales}}))}return Promise.resolve()})))));s.then((()=>i(l,r,!0,void 0)),(e=>i(l,r,!1,e)))}return!0}),!1)},t.enableControllerAnalytics=function(){if(!e.appTarget.appTheme.allowParentController||!e.BrowserUtils.isIFrame())return;const t=e.tickEvent;e.tickEvent=function(e,o){t&&t(e,o),r({type:"pxthost",action:"event",tick:e,response:!1,data:o})};const o=e.reportException;e.reportException=function(e,t){o&&o(e,t);try{r({type:"pxthost",action:"event",tick:"error",message:e.message,response:!1,data:t})}catch(e){}};const i=e.reportError;e.reportError=function(e,t,o){i&&i(e,t,o),r({type:"pxthost",action:"event",tick:"error",category:e,message:t,data:o})}},t.shouldPostHostMessages=function(){return e.appTarget.appTheme.allowParentController&&e.BrowserUtils.isIFrame()},t.postHostMessageAsync=r}(e.editor||(e.editor={}))}(pxt||(pxt={})),function(e){!function(t){!function(t){function o(e){return`experiments-${"object"==typeof e?e.id:e}`}function i(){const t=e.savedAppTheme(),o={},i=r();return i.forEach((e=>{const i=s(e);t[e.id]=!!i,i&&(o[e.id]=i?1:0)})),i.length&&Object.keys(o).length&&(e.tickEvent("experiments.loaded",o),e.reloadAppTargetVariant()),e.appTarget.appTheme}function r(){const t=e.appTarget.appTheme.experiments;return t?[{id:"print",name:lf("Print Code"),description:lf("Print the code from the current project"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4740"},{id:"greenScreen",name:lf("Green screen"),description:lf("Display a webcam video stream or a green background behind the code."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4738"},{id:"allowPackageExtensions",name:lf("Editor Extensions"),description:lf("Allow Extensions to add buttons in the editor."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4741"},{id:"instructions",name:lf("Wiring Instructions"),description:lf("Generate step-by-step assembly instructions for breadboard wiring."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4739"},{id:"debugger",name:lf("Debugger"),description:lf("Step through code and inspect variables in the debugger"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4729"},{id:"bluetoothUartConsole",name:"Bluetooth Console",description:lf("Receives UART message through Web Bluetooth"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4796"},{id:"bluetoothPartialFlashing",name:"Bluetooth Download",description:lf("Download code via Web Bluetooth"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4807"},{id:"simScreenshot",name:lf("Simulator Screenshots"),description:lf("Download screenshots of the simulator"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5232"},{id:"python",name:lf("Static Python"),description:lf("Use Static Python to code your device"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5390"},{id:"simGif",name:lf("Simulator Gifs"),description:lf("Download gifs of the simulator"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5297"},{id:"qrCode",name:lf("Shared QR Code"),description:lf("Generate a QR Code form the shared project url"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5456"},{id:"importExtensionFiles",name:lf("Import Extension Files"),description:lf("Import Extensions from compiled project files")},{id:"debugExtensionCode",name:lf("Debug Extension Code"),description:lf("Use the JavaScript debugger to debug extension code")},{id:"snippetBuilder",name:lf("Snippet Builder"),description:lf("Try out the new snippet dialogs.")},{id:"experimentalHw",name:lf("Experimental Hardware"),description:lf("Enable support for hardware marked 'experimental' in the hardware seletion dialog")},{id:"checkForHwVariantWebUSB",name:lf("Detect Hardware with WebUSB"),description:lf("When compiling, use WebUSB to detect hardware configuration.")},{id:"githubEditor",name:lf("GitHub editor"),description:lf("Review, commit and push to GitHub."),feedbackUrl:"https://github.com/microsoft/pxt/issues/6419",enableOnline:!0},{id:"githubCompiledJs",name:lf("GitHub Pages JavaScript"),description:lf("Commit compiled javascript when creating a release"),enableOnline:!0},{id:"blocksCollapsing",name:lf("Collapse blocks"),description:lf("Collapse and expand functions or event blocks")},{id:"tutorialBlocksDiff",name:lf("Tutorial Block Diffs"),description:lf("Automatially render blocks diff in tutorials")},{id:"openProjectNewTab",name:lf("Open in New Tab"),description:lf("Open an editor in a new tab.")},{id:"openProjectNewDependentTab",name:lf("Open in New Connected Tab"),description:lf("Open connected editors in different browser tabs.")},{id:"accessibleBlocks",name:lf("Accessible Blocks"),description:lf("Use the WASD keys to move and modify blocks."),feedbackUrl:"https://github.com/microsoft/pxt/issues/6850"},{id:"errorList",name:lf("Error List"),description:lf("Show an error list panel for JavaScript and Python.")},{id:"blocksErrorList",name:lf("Blocks Error List"),description:lf("Show an error list panel for Blocks")}].filter((o=>t.indexOf(o.id)>-1&&!(e.BrowserUtils.isPxtElectron()&&o.enableOnline))):[]}function s(t){return!!e.storage.getLocal(o(t))}function n(t,r){r!=s(t)&&(r?e.storage.setLocal(o(t),"1"):e.storage.removeLocal(o(t)),i())}t.syncTheme=i,t.all=r,t.clear=function(){r().forEach((t=>e.storage.removeLocal(o(t)))),i()},t.someEnabled=function(){return r().some((e=>s(e)))},t.isEnabled=s,t.toggle=function(e){n(e,!s(e))},t.state=function(){const e={};return r().forEach((t=>e[t.id]=s(t))),JSON.stringify(e)},t.setState=n}(t.experiments||(t.experiments={}))}(e.editor||(e.editor={}))}(pxt||(pxt={})),function(e){!function(t){class o{constructor(){this.items={}}removeItem(e){delete this.items[e]}getItem(e){return this.items[e]}setItem(e,t){this.items[e]=t}clear(){this.items={}}}class i{constructor(e){this.storageId=e}targetKey(e){return this.storageId+"/"+e}removeItem(e){window.localStorage.removeItem(this.targetKey(e))}getItem(e){return window.localStorage[this.targetKey(e)]}setItem(e,t){window.localStorage[this.targetKey(e)]=t}clear(){let e=this.targetKey(""),t=[];for(let o=0;o<window.localStorage.length;++o){let i=window.localStorage.key(o);0==i.indexOf(e)&&t.push(i)}t.forEach((e=>window.localStorage.removeItem(e)))}}function r(){if(e.appTarget)return e.appTarget.id;const t=window.pxtConfig;if(t)return t.targetId;const o=window.pxtTargetBundle;return o?o.id:""}let s;function n(){if(s)return;const t=r();let n=!1;if(!e.shell.isSandboxMode())try{window.localStorage[t]="1";window.localStorage[t];n=!0}catch(e){}n?(s=new i(t),e.debug(`storage: local under ${t}`)):(s=new o,e.debug("storage: in memory"))}t.storageId=r,t.setLocal=function(e,t){n(),s.setItem(e,t)},t.getLocal=function(e){return n(),s.getItem(e)},t.removeLocal=function(e){n(),s.removeItem(e)},t.clearLocal=function(){n(),s.clear()}}(e.storage||(e.storage={}))}(pxt||(pxt={})),function(e){!function(t){function o(t){const o=e.appTarget.appTheme.invertedMonaco,i=!(!e.appTarget.appTheme.monacoFieldEditors||!e.appTarget.appTheme.monacoFieldEditors.length),r=e.BrowserUtils.isAndroid();let s=monaco.editor.create(t,{model:null,ariaLabel:e.Util.lf("JavaScript editor"),fontFamily:"'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', 'monospace'",scrollBeyondLastLine:!0,language:"typescript",mouseWheelZoom:!1,wordBasedSuggestions:!0,lineNumbersMinChars:3,formatOnPaste:!0,folding:i,glyphMargin:i||e.appTarget.appTheme.debugger,minimap:{enabled:!1},fixedOverflowWidgets:!0,autoIndent:"full",useTabStops:!0,dragAndDrop:!0,matchBrackets:"always",occurrencesHighlight:!1,quickSuggestionsDelay:200,theme:o?"vs-dark":"vs",renderIndentGuides:!0,accessibilityHelpUrl:"",quickSuggestions:{other:!r,comments:!r,strings:!r},acceptSuggestionOnCommitCharacter:!r,acceptSuggestionOnEnter:r?"off":"on",accessibilitySupport:r?"off":"on"});return s.layout(),s}t.syncModels=function(e,t,o,i){if(i)return;let r=monaco.languages.typescript.typescriptDefaults.getExtraLibs(),s={};e.sortedDeps().forEach((e=>{e.getFiles().forEach((i=>{let r=e.id+"/"+i;if(/\.(ts)$/.test(i)&&r!=o){if(!monaco.languages.typescript.typescriptDefaults.getExtraLibs()[r]){let o=e.readFile(i)||"\n";t[r]=monaco.languages.typescript.typescriptDefaults.addExtraLib(o,r)}s[r]="1"}}))})),Object.keys(r).filter((e=>/\.(ts)$/.test(e)&&!s[e])).forEach((e=>{t[e].dispose()}))},t.initMonacoAsync=function(t){return new Promise(((i,r)=>{if("object"==typeof window.monaco)return void i(o(t));let s=window.MonacoPaths,n=()=>{let r=window.require;r.config({paths:s}),r(["vs/editor/editor.main"],(()=>{monaco.languages.register({id:"asm",extensions:[".asm"]}),monaco.languages.setMonarchTokensProvider("asm",{tokenPostfix:"",keywords:["movs","mov","adds","add","adcs","adr","subs","sbcs","sub","rsbs","muls","cmp","cmn","ands","eors","orrs","bics","mvns","tst","lsls","lsrs","asrs","rors","ldr","ldrh","ldrb","ldrsh","ldrsb","ldm","str","strh","strb","stm","push","pop","cbz","cbnz","b","bl","bx","blx","sxth","sxtb","uxth","uxtb","rev","rev16","revsh","svc","cpsid","cpsie","setend","bkpt","nop","sev","wfe","wfi","yield","beq","bne","bcs","bhs","bcc","blo","bmi","bpl","bvs","bvc","bhi","bls","bge","blt","bgt","ble","bal","r0","r1","r2","r3","r4","r5","r6","r7","r8","r9","r10","r11","r12","r13","r14","r15","pc","sp","lr"],typeKeywords:[".startaddr",".hex",".short",".space",".section",".string",".byte"],operators:[],symbols:/[:\*]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,tokenizer:{root:[[/(\.)?[a-z_$\.][\w$]*/,{cases:{"@typeKeywords":"keyword","@keywords":"keyword","@default":"identifier"}}],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"operator","@default":""}}],[/@\s*[a-zA-Z_\$][\w\$]*/,{token:"annotation"}],[/(#|(0[xX]))?[0-9a-fA-F]+/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,{token:"string.quote",bracket:"@open",next:"@string"}],[/'[^\\']'/,"string"],[/(')(@escapes)(')/,["string","string.escape","string"]],[/'/,"string.invalid"]],comment:[],string:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,{token:"string.quote",bracket:"@close",next:"@pop"}]],whitespace:[[/[ \t\r\n]+/,"white"],[/\/\*/,"comment","@comment"],[/;.*$/,"comment"]]}}),monaco.languages.typescript&&(monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSyntaxValidation:!0,noSemanticValidation:!0}),monaco.languages.typescript.typescriptDefaults.setWorkerOptions({customWorkerPath:e.webConfig.typeScriptWorkerJs}),monaco.languages.typescript.typescriptDefaults.setCompilerOptions({allowUnreachableCode:!0,noImplicitAny:!0,allowJs:!1,allowUnusedLabels:!0,target:monaco.languages.typescript.ScriptTarget.ES5,outDir:"built",rootDir:".",noLib:!0,mouseWheelZoom:!1})),i(o(t))}))};if(window.require)n();else{let e=document.createElement("script");e.type="text/javascript",e.src=s["vs/loader"],e.addEventListener("load",n),document.body.appendChild(e)}}))},t.createEditor=o}(e.vs||(e.vs={}))}(pxt||(pxt={})),function(e){!function(t){let o,i;!function(e){e[e.IDE=0]="IDE",e[e.Sandbox=1]="Sandbox",e[e.Widget=2]="Widget",e[e.Controller=3]="Controller"}(o=t.EditorLayoutType||(t.EditorLayoutType={}));let r=!1,s=!1;function n(){if(void 0!==i)return;const t=/sandbox=1|#sandbox|#sandboxproject/i.test(window.location.href)||e.BrowserUtils.isIFrame(),n=/nosandbox=1/i.test(window.location.href),a=/controller=1/i.test(window.location.href)&&e.BrowserUtils.isIFrame(),c=/readonly=1/i.test(window.location.href),d=/editorlayout=(widget|sandbox|ide)/i.exec(window.location.href),p=/noproject=1/i.test(window.location.href);if(i=o.IDE,n?i=o.Widget:a?i=o.Controller:t&&(i=o.Sandbox),a&&c&&(r=!0),a&&p&&(s=!0),d)switch(d[1].toLowerCase()){case"widget":i=o.Widget;break;case"sandbox":i=o.Sandbox;break;case"ide":i=o.IDE}e.debug(`shell: layout type ${o[i]}, readonly ${l()}`)}function a(){return n(),i==o.Sandbox}function l(){return a()&&!/[?&]edit=1/i.test(window.location.href)||c()&&r}function c(){return n(),i==o.Controller}t.layoutTypeClass=function(){return n(),e.shell.EditorLayoutType[i].toLowerCase()},t.isSandboxMode=a,t.isReadOnly=l,t.isNoProject=function(){return s},t.isControllerMode=c,t.isPyLangPref=function(){return"py"==e.storage.getLocal("editorlangpref")},t.getEditorLanguagePref=function(){return e.storage.getLocal("editorlangpref")},t.setEditorLanguagePref=function(t){t.match(/prj$/)&&(t=t.replace(/prj$/,"")),e.storage.setLocal("editorlangpref",t)},t.getToolboxAnimation=function(){return e.storage.getLocal("toolboxanimation")},t.setToolboxAnimation=function(){e.storage.setLocal("toolboxanimation","1")}}(e.shell||(e.shell={}))}(pxt||(pxt={})),function(e){!function(t){t.freshHeader=function(t,o){return{target:e.appTarget.id,targetVersion:e.appTarget.versions.target,name:t,meta:{},editor:e.JAVASCRIPT_PROJECT_NAME,pubId:"",pubCurrent:!1,_rev:null,id:e.U.guidGen(),recentUse:o,modificationTime:o,blobId_:null,blobVersion_:null,blobCurrent_:!1,cloudUserId:null,cloudCurrent:!1,cloudVersion:null,cloudLastSyncTime:0,isDeleted:!1}}}(e.workspace||(e.workspace={}))}(pxt||(pxt={})),function(e){!function(e){const t={};e.registerMonacoFieldEditor=function(e,o){t[e]=o},e.getMonacoFieldEditor=function(e){return t[e]}}(e.editor||(e.editor={}))}(pxt||(pxt={})),function(e){!function(t){t.MonacoReactFieldEditor=class{getId(){return"image-editor"}showEditorAsync(t,o,i){return this.fileType=t,this.editrange=o,this.host=i,this.initAsync().then((()=>{const t=this.textToValue(i.getText(o));return t?(this.fv=e.react.getFieldEditorView(this.getFieldEditorId(),t,this.getOptions()),this.fv.onHide((()=>{this.onClosed()})),this.fv.show(),new Promise(((e,t)=>{this.resolver=e,this.rejecter=t}))):Promise.resolve(null)}))}onClosed(){this.resolver&&(this.resolver({range:this.editrange,replacement:this.resultToText(this.fv.getResult())}),this.editrange=void 0,this.resolver=void 0,this.rejecter=void 0)}dispose(){this.onClosed()}initAsync(){return Promise.resolve()}textToValue(e){return null}resultToText(e){return e+""}getFieldEditorId(){return""}getOptions(){return null}}}(e.editor||(e.editor={}))}(pxt||(pxt={})),function(e){!function(t){const o="image-editor";class i extends t.MonacoReactFieldEditor{textToValue(t){this.isPython=-1===t.indexOf("`");const o=e.parseAssetTSReference(t);if(o){const{type:t,name:i}=o,r=i.trim(),s=e.react.getTilemapProject();this.isAsset=!0;const n=s.lookupAssetByName("image",r);if(n)return n;{const t=s.createNewImage();return r&&!s.isNameTaken("image",r)&&e.validateAssetName(r)&&(t.meta.displayName=r),t}}return{type:"image",id:"",internalID:0,bitmap:e.sprite.imageLiteralToBitmap(t).data(),meta:{},jresData:""}}resultToText(t){var o;if(null===(o=t.meta)||void 0===o?void 0:o.displayName){const o=e.react.getTilemapProject();return this.isAsset?t=o.updateAsset(t):(this.isAsset=!0,t=o.createNewProjectImage(t.bitmap,t.meta.displayName)),e.getTSReferenceForAsset(t,this.isPython)}return e.sprite.bitmapToImageLiteral(e.sprite.Bitmap.fromData(t.bitmap),this.isPython?"python":"typescript")}getFieldEditorId(){return"image-editor"}getOptions(){return{initWidth:16,initHeight:16,blocksInfo:this.host.blocksInfo()}}}t.MonacoSpriteEditor=i,t.spriteEditorDefinition={id:o,foldMatches:!0,glyphCssClass:"sprite-editor-glyph sprite-focus-hover",heightInPixels:510,matcher:{searchString:'(?:img|assets\\s*\\.\\s*image)\\s*(?:`|\\(\\s*""")(?:[^"`]|\\n)*\\s*(?:`|"""\\s*\\))',isRegex:!0,matchCase:!0,matchWholeWord:!1},proto:i},t.registerMonacoFieldEditor(o,t.spriteEditorDefinition)}(e.editor||(e.editor={}))}(pxt||(pxt={})),function(e){!function(t){const o="tilemap-editor";class i extends t.MonacoReactFieldEditor{textToValue(t){const o=this.readTilemap(t),i=e.react.getTilemapProject();return e.sprite.addMissingTilemapTilesAndReferences(i,o),o}readTilemap(t){const o=e.react.getTilemapProject();if(/^\s*tiles\s*\./.test(t)&&(this.isTilemapLiteral=!1,t)){try{return function(e){return{type:"tilemap",id:"",internalID:0,meta:{},data:e}}(e.sprite.decodeTilemap(t,"typescript",o))}catch(e){}return null}this.isTilemapLiteral=!0;const i=/^\s*(tilemap(?:8|16|32)?)\s*(?:`([^`]*)`)|(?:\(\s*"""([^"]*)"""\s*\))\s*$/.exec(t),r=(i[2]||i[3]||"").trim();let s,n;if(this.tilemapLiteral=i[1],r){let e=ts.pxtc.escapeIdentifier(r);s=o.getTilemap(e)}if(!s){let e=16;"tilemap8"===this.tilemapLiteral?e=8:"tilemap32"===this.tilemapLiteral&&(e=32);const[t]=o.createNewTilemap(n,e,16,16);s=o.getTilemap(t),n=t}return s}resultToText(t){const o=e.react.getTilemapProject();return o.pushUndo(),e.sprite.updateTilemapReferencesFromResult(o,t),this.isTilemapLiteral?(o.updateAsset(t),e.getTSReferenceForAsset(t,"python"===this.fileType)):e.sprite.encodeTilemap(t.data,"typescript"===this.fileType?"typescript":"python")}getFieldEditorId(){return"tilemap-editor"}getOptions(){return{initWidth:16,initHeight:16,blocksInfo:this.host.blocksInfo()}}getCreateTilemapRange(){const e=this.editrange.getStartPosition();let t,o=this.editrange.getEndPosition(),i=1;for(;;){t=new monaco.Range(o.lineNumber,o.column,o.lineNumber+1,0);const r=this.host.getText(t);for(let t=0;t<r.length;t++)if("("===r.charAt(t))i++;else if(")"===r.charAt(t)&&(i--,0===i)){const i=new monaco.Position(o.lineNumber,o.column+t+2);return monaco.Range.fromPositions(e,i)}if(o=t.getEndPosition(),o.lineNumber>e.lineNumber+20)return null}}}t.MonacoTilemapEditor=i,t.tilemapEditorDefinition={id:o,foldMatches:!0,alwaysBuildOnClose:!0,glyphCssClass:"sprite-focus-hover ms-Icon ms-Icon--Nav2DMapView",heightInPixels:510,weight:5,matcher:{searchString:'(?:tilemap(?:8|16|32)?\\s*(?:`|\\(""")(?:[ a-zA-Z0-9_]|\\n)*\\s*(?:`|"""\\)))|(?:tiles\\s*\\.\\s*createTilemap\\s*\\([^\\)]+\\))',isRegex:!0,matchCase:!0,matchWholeWord:!1},proto:i},t.registerMonacoFieldEditor(o,t.tilemapEditorDefinition)}(e.editor||(e.editor={}))}(pxt||(pxt={}));